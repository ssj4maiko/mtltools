(()=>{"use strict";const g=l=>l.replace("-","\\-").replace("[","\\[").replace("]","\\]").replace("(","\\(").replace(")","\\)"),f=(l,s,r)=>{for(;0!==l.length;){const e=l.pop(),n=new RegExp(g(e.entryOriginal),"g"),t="["+e.idCategory+'[<span class="replaced" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>]"+e.idCategory+"]";r=r.replace(n,t),s=s.replace(n,t)}return[s,r]},h=(l,s,r)=>{for(;0!==l.length;){const e=l.pop();let n,t;e.sufix?(n=new RegExp("(]"+e.sufix+"]"+g(e.entryOriginal)+")","g"),t='<span class="replaced sufix" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>]"+e.idCategory+"]"):(n=new RegExp("("+g(e.entryOriginal)+"\\["+e.prefix+"\\[)","g"),t="["+e.idCategory+'[<span class="replaced prefix" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>"),r=r.replace(n,t),s=s.replace(n,t)}return[s,r]};addEventListener("message",l=>{let{categories:s,text:r,title:e}=l.data;if(s.length>0){let n=[],t=[];s.forEach((i,u)=>{i.entries&&i.entries.forEach((a,E)=>{if(a.entryOriginal&&!a.delete){let w=new RegExp("(\\p{P})+","gu");const x=a.entryOriginal.replace(w,""),p=x.length,c={entryOriginal:a.entryOriginal,entryTranslation:a.entryTranslation,description:a.description,id:a.id,idCategory:i.id,category:i.name,simplified:x,index:[u,E]};a.sufix||a.prefix?(c.sufix=a.sufix,c.prefix=a.prefix,t[p]||(t[p]=[]),t[p].push(c)):(n[p]||(n[p]=[]),n[p].push(c))}})});try{for(let i=n.length;i>=0;--i)n[i]&&([r,e]=f(n[i],r,e));for(let i=t.length;i>=0;--i)t[i]&&([r,e]=h(t[i],r,e));console.log("finished translation")}catch(i){console.error("TIMEOUT",i)}const o="\\][0-9]+\\]",d="\\[[0-9]+\\[";try{let i=new RegExp("("+o+d+")+","gm");e=e.replace(i," "),r=r.replace(i," "),i=new RegExp("("+o+")+","gm"),e=e.replace(i,""),r=r.replace(i,""),i=new RegExp("("+d+")+","gm"),e=e.replace(i,""),r=r.replace(i,"")}catch(i){console.info(o+d),console.error(i)}}postMessage({text:r,title:e})})})();