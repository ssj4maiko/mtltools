(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{z3cj:function(t,e,i){"use strict";i.r(e),i.d(e,"EntryModule",(function(){return v}));var o=i("ofXK"),n=i("tyNb"),r=i("yTNM"),s=i("b/G4"),a=i("3Pt+"),l=i("fXoL"),c=i("P6Fj"),b=i("o4Jw");function d(t,e){if(1&t&&(l.Ob(0,"tr"),l.Ob(1,"td"),l.oc(2),l.Nb(),l.Ob(3,"td"),l.oc(4),l.Nb(),l.Ob(5,"td"),l.oc(6),l.Nb(),l.Nb()),2&t){const t=e.$implicit;l.yb(2),l.pc(t[0]),l.yb(2),l.pc(t[1]),l.yb(2),l.pc(t[2])}}function h(t,e){if(1&t&&(l.Ob(0,"table",18),l.Ob(1,"thead"),l.Ob(2,"tr"),l.Ob(3,"th"),l.oc(4,"Original"),l.Nb(),l.Ob(5,"th"),l.oc(6,"Translated"),l.Nb(),l.Ob(7,"th"),l.oc(8,"Description"),l.Nb(),l.Nb(),l.Nb(),l.Ob(9,"tbody"),l.mc(10,d,7,3,"tr",17),l.Nb(),l.Nb()),2&t){const t=l.Xb();l.yb(10),l.ac("ngForOf",t.tmpResult)}}function u(t,e){if(1&t){const t=l.Pb();l.Ob(0,"div",2),l.Ob(1,"div",3),l.Ob(2,"a",19),l.Vb("click",(function(){return l.ic(t),l.Xb().openModal("import-list")})),l.oc(3,"Import List"),l.Nb(),l.Nb(),l.Nb()}}function y(t,e){if(1&t){const t=l.Pb();l.Ob(0,"div",2),l.Ob(1,"div",3),l.Ob(2,"button",19),l.Vb("click",(function(){return l.ic(t),l.Xb().submitForm()})),l.oc(3,"Save"),l.Nb(),l.Nb(),l.Ob(4,"div",3),l.Ob(5,"a",19),l.Vb("click",(function(){return l.ic(t),l.Xb().addItem()})),l.oc(6,"Add Entry"),l.Nb(),l.Nb(),l.Nb()}}function p(t,e){1&t&&l.Kb(0)}function g(t,e){if(1&t&&(l.Ob(0,"option",33),l.oc(1),l.Nb()),2&t){const t=e.$implicit;l.bc("value",t.id),l.yb(1),l.pc(t.name)}}const m=function(t,e,i){return{new:t,deleted:e,changed:i}};function f(t,e){if(1&t&&(l.Mb(0),l.Ob(1,"tr",20),l.Ob(2,"td"),l.Ob(3,"select",21),l.mc(4,g,2,2,"option",22),l.Nb(),l.Nb(),l.Ob(5,"td"),l.Jb(6,"input",23),l.Jb(7,"input",24),l.Jb(8,"input",25),l.Nb(),l.Ob(9,"td"),l.Jb(10,"input",26),l.Nb(),l.Ob(11,"td"),l.Jb(12,"textarea",27),l.Nb(),l.Ob(13,"td"),l.Ob(14,"label",28),l.Jb(15,"i",29),l.Jb(16,"input",30),l.Nb(),l.Nb(),l.Ob(17,"td"),l.Ob(18,"label",28),l.Jb(19,"i",31),l.Jb(20,"input",32),l.Nb(),l.Nb(),l.Nb(),l.Lb()),2&t){const t=e.$implicit,i=e.index,o=l.Xb();l.yb(1),l.ac("formGroupName",i)("ngClass",l.fc(3,m,0==t.controls.id.value,1==t.controls.delete.value,1==t.controls.update.value)),l.yb(3),l.ac("ngForOf",o.categories)}}function O(t,e){1&t&&l.Kb(0)}const N=[{path:"",component:(()=>{class t{constructor(t,e,i,o,n,r){this.router=t,this.route=e,this.api=i,this.formBuilder=o,this.modalService=n,this.papa=r,this.entries=[],this.categories=[],this.tmpResult=[]}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.idDictionary=this.route.snapshot.params.idDictionary,this.idCategory=this.route.snapshot.params.idCategory,this.novel=this.api.Novel(this.idNovel),this.dictionary=this.api.Dictionary(this.idNovel,this.idDictionary),this.categories=Object.values(this.api.Categories(this.idDictionary)),this.entryForm=this.formBuilder.group({idCategory:"",entries:this.formBuilder.array([this.createItem()])}),this.novel?this.dictionaryList():this.api.getNovel(this.idNovel).subscribe(t=>{this.novel=this.api.Novel(this.idNovel),this.dictionaryList()},t=>{console.log(t)})}ngOnDestroy(){delete this.entries,delete this.novel,delete this.dictionary,delete this.categories,delete this.entries2Save,delete this.entryForm,delete this.entryArray,delete this.idCategory,delete this.idDictionary,delete this.idNovel,console.log("DESTROY!")}dictionaryList(){this.dictionary?this.categoryList():this.api.getDictionaries(this.idNovel).subscribe(t=>{this.dictionary=this.api.Dictionary(this.idNovel,this.idDictionary),this.categoryList()},t=>{console.log(t)})}categoryList(){this.categories.length?this.entryList():this.api.getCategories(this.idNovel,this.idDictionary).subscribe(t=>{this.categories=Object.values(this.api.Categories(this.idDictionary)),this.entryList()},t=>{console.log(t)})}entryList(){this.api.getEntries(this.idDictionary,this.idCategory).subscribe(t=>{this.entries=Object.values(this.api.Entries(this.idCategory)),this.fillForm()},t=>{console.log(t)})}createItem(){let t=this.formBuilder.group({id:"",idCategory:this.idCategory,entryOriginal:"",entryTranslation:"",description:"",update:"",delete:"",reset:""});return this.entryArray&&this.onChanges(t,this.entryArray.length),t}addItem(){this.entryArray=this.entryForm.get("entries");let t=this.createItem();this.entryArray.push(t)}onChanges(t,e){let i,o=!1,n=0;t.valueChanges.subscribe(r=>{if(0===n)if(console.log(r),i||(i=this.api.Entry(this.idCategory,r.id),console.log(i)),r.reset&&(console.log("reset"),n=6,t.controls.reset.setValue(!1),t.controls.update.setValue(!1),t.controls.delete.setValue(!1),t.controls.idCategory.setValue(r.id?i.idCategory:""),t.controls.entryOriginal.setValue(r.id?i.entryOriginal:""),t.controls.entryTranslation.setValue(r.id?i.entryTranslation:""),t.controls.description.setValue(r.id?i.description:"")),r.id){let e=r.idCategory!=i.idCategory||r.entryOriginal!=i.entryOriginal||r.entryTranslation!=i.entryTranslation||r.description!=i.description||r.delete!=o;e!=r.update&&(n=1,t.controls.update.setValue(e)),r.delete&&(o=r.delete)}else r.delete&&this.entryArray.removeAt(e);else console.log("counter",n),--n})}fillForm(){this.entryForm.patchValue({idCategory:this.idCategory}),this.entryForm.setControl("entries",this.setExistingEntries(this.entries)),this.addItem()}setExistingEntries(t){const e=new a.c([]);let i=null;return t.forEach(t=>{i=this.formBuilder.group({id:t.id,idCategory:t.idCategory,entryOriginal:t.entryOriginal,entryTranslation:t.entryTranslation,description:t.description,update:!1,delete:!1,reset:!1}),this.onChanges(i,e.length),e.push(i)}),this.entryArray=e,e}submitForm(){console.log(this.entryForm.value),this.api.addEntries(this.idDictionary,this.idCategory,this.entryForm.value).subscribe(t=>{t.changes?this.api.getEntries(this.idDictionary,this.idCategory).subscribe(t=>{this.router.navigate(["/novel/dictionary/",this.idNovel,this.idDictionary])},t=>{console.log("Didn't move because: ",t)}):this.router.navigate(["/novel/dictionary/",this.idNovel,this.idDictionary])},t=>{console.log(t)})}openModal(t){this.modalService.open(t)}closeModal(t){this.modalService.close(t)}uploadFile(t){this.file=t.target.files[0];let e=new FileReader;e.onload=t=>{this.papa.parse(e.result,{complete:t=>{this.tmpResult=t.data,this.openModal("confirm-import")}})},e.readAsText(this.file)}cancelImport(){this.tmpResult=[],this.closeModal("confirm-import")}commitImport(){let t;for(t=this.entryArray.value.length-1;t>-1;--t)if(""!=this.entryArray.value[t].id||""!=this.entryArray.value[t].idCategory||""!=this.entryArray.value[t].entryOriginal||""!=this.entryArray.value[t].entryTranslation||""!=this.entryArray.value[t].description){++t;break}this.tmpResult.forEach(e=>{let i=this.formBuilder.group({id:"",idCategory:this.idCategory,entryOriginal:e[0],entryTranslation:e[1],description:e[2],update:!1,delete:!1,reset:!1});this.entryArray.controls[t]?(this.onChanges(i,t),this.entryArray.controls[t]=i):(this.onChanges(i,this.entryArray.length),this.entryArray.push(i)),++t}),this.entryArray.controls[t]||this.addItem(),this.closeModal("confirm-import"),this.closeModal("import-list")}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(n.c),l.Ib(n.a),l.Ib(r.a),l.Ib(a.e),l.Ib(s.a),l.Ib(c.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-list"]],hostBindings:function(t,e){1&t&&l.Vb("blur",(function(t){return e.onBlur(t)}))},decls:60,vars:5,consts:[["id","import-list"],[1,"h1"],[1,"columns","actionButtons"],[1,"column"],[1,"button","is-primary"],["type","file",1,"hidden",3,"change"],[1,"button","is-danger",3,"click"],["id","confirm-import"],["class","table",4,"ngIf"],[1,"button","is-primary",3,"click"],["actionButtons",""],["footerButtons",""],[4,"ngTemplateOutlet"],["id","entryForm",3,"formGroup","submit"],["type","hidden","formControlName","idCategory"],[1,"table","is-stripede","is-fullwidth"],["formArrayName","entries",1,"tableContent"],[4,"ngFor","ngForOf"],[1,"table"],[1,"button","is-info",3,"click"],[3,"formGroupName","ngClass"],["formControlName","idCategory"],[3,"value",4,"ngFor","ngForOf"],["formControlName","id","type","hidden"],["formControlName","update","type","hidden"],["formControlName","entryOriginal","type","text",1,"input"],["formControlName","entryTranslation","type","text",1,"input"],["formControlName","description","rows","1",1,"textarea"],[1,"icon","is-large"],[1,"fas","fa-exclamation-triangle"],["formControlName","reset","type","checkbox",1,"hidden"],[1,"fas","fa-times"],["formControlName","delete","type","checkbox",1,"hidden"],[3,"value"]],template:function(t,e){if(1&t&&(l.Ob(0,"jw-modal",0),l.Ob(1,"h1",1),l.oc(2,"Importing a file"),l.Nb(),l.Ob(3,"p"),l.Ob(4,"b"),l.oc(5,"File type"),l.Nb(),l.oc(6,": CSV"),l.Nb(),l.Ob(7,"p"),l.Ob(8,"b"),l.oc(9,"Columns"),l.Nb(),l.oc(10,': "Original";"Translated";"Description"'),l.Nb(),l.Ob(11,"p"),l.Ob(12,"b"),l.oc(13,"Instructions"),l.Nb(),l.oc(14,": Select the file and the imported data will be shown below before they are commited to the main screen. In case of error, check the file through a normal text editor and see if it follows the above style. Also, there is no header, so in case your file has it, you can manually delete it later "),l.Nb(),l.Ob(15,"div",2),l.Ob(16,"div",3),l.Ob(17,"label",4),l.oc(18," Select File "),l.Ob(19,"input",5),l.Vb("change",(function(t){return e.uploadFile(t)})),l.Nb(),l.Nb(),l.Nb(),l.Ob(20,"div",3),l.Ob(21,"button",6),l.Vb("click",(function(){return e.closeModal("import-list")})),l.oc(22,"Close"),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Ob(23,"jw-modal",7),l.Ob(24,"h1"),l.oc(25,"Is this what you were looking for?"),l.Nb(),l.mc(26,h,11,1,"table",8),l.Ob(27,"div",2),l.Ob(28,"div",3),l.Ob(29,"button",9),l.Vb("click",(function(){return e.commitImport()})),l.oc(30,"Yes"),l.Nb(),l.Nb(),l.Ob(31,"div",3),l.Ob(32,"button",6),l.Vb("click",(function(){return e.cancelImport()})),l.oc(33,"No"),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.mc(34,u,4,0,"ng-template",null,10,l.nc),l.mc(36,y,7,0,"ng-template",null,11,l.nc),l.mc(38,p,1,0,"ng-container",12),l.Ob(39,"div"),l.Ob(40,"form",13),l.Vb("submit",(function(){return e.submitForm()})),l.Jb(41,"input",14),l.Ob(42,"table",15),l.Ob(43,"thead"),l.Ob(44,"tr"),l.Ob(45,"th"),l.oc(46,"Category"),l.Nb(),l.Ob(47,"th"),l.oc(48,"Original"),l.Nb(),l.Ob(49,"th"),l.oc(50,"Translated"),l.Nb(),l.Ob(51,"th"),l.oc(52,"Description"),l.Nb(),l.Ob(53,"th"),l.oc(54,"Reset"),l.Nb(),l.Ob(55,"th"),l.oc(56,"Delete"),l.Nb(),l.Nb(),l.Nb(),l.Ob(57,"tbody",16),l.mc(58,f,21,7,"ng-container",17),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.mc(59,O,1,0,"ng-container",12)),2&t){const t=l.hc(35),i=l.hc(37);l.yb(26),l.ac("ngIf",e.tmpResult.length),l.yb(12),l.ac("ngTemplateOutlet",t),l.yb(2),l.ac("formGroup",e.entryForm),l.yb(18),l.ac("ngForOf",e.entryForm.get("entries").controls),l.yb(1),l.ac("ngTemplateOutlet",i)}},directives:[b.a,o.j,o.n,a.q,a.k,a.g,a.b,a.j,a.f,a.d,o.i,a.h,o.h,a.o,a.a,a.m,a.p],styles:[".actionButtons[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%], .actionButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;width:100%}.hidden[_ngcontent-%COMP%]{display:none}.tableContent[_ngcontent-%COMP%]   .changed[_ngcontent-%COMP%]{background-color:green}.tableContent[_ngcontent-%COMP%]   .new[_ngcontent-%COMP%]{background-color:#00f}.tableContent[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{background-color:red}"]}),t})(),data:{title:"List Entries"}},{path:"**",redirectTo:""}];let C=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[n.g.forChild(N)],n.g]}),t})(),v=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[o.b,C,a.i,a.n]]}),t})()}}]);