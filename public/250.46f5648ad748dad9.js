(()=>{"use strict";const f=p=>p.replace("-","\\-").replace("[","\\[").replace("]","\\]").replace("(","\\(").replace(")","\\)"),m=(p,a,n)=>{for(;0!==p.length;){const e=p.pop(),t=new RegExp(f(e.entryOriginal),"g"),i=0===e.entryTranslation.length?"":"["+e.idCategory+'[<span class="replaced" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>]"+e.idCategory+"]";n=n.replace(t,i),a=a.replace(t,i)}return[a,n]},E=(p,a,n)=>{for(;0!==p.length;){const e=p.pop();let t,i;e.sufix?(t=new RegExp("(]"+e.sufix+"]"+f(e.entryOriginal)+")","g"),i='<span class="replaced sufix" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>]"+e.idCategory+"]"):(t=new RegExp("("+f(e.entryOriginal)+"\\["+e.prefix+"\\[)","g"),i="["+e.idCategory+'[<span class="replaced prefix" '+(e.description?`title="${e.description}"`:"")+' id="replaced-'+e.index[0]+"-"+e.index[1]+'">'+e.entryTranslation+"</span>"),n=n.replace(t,i),a=a.replace(t,i)}return[a,n]};addEventListener("message",p=>{let{categories:a,text:n,title:e}=p.data;if(a.length>0){let t=[],i=[];a.forEach((r,x)=>{r.entries&&r.entries.forEach((s,u)=>{if(s.entryOriginal&&!s.delete){let c=new RegExp("(\\p{P})+","gu");const h=s.entryOriginal.replace(c,""),o=h.length,d={entryOriginal:s.entryOriginal,entryTranslation:s.entryTranslation,description:s.description,id:s.id,idCategory:r.id,category:r.name,simplified:h,index:[x,u]};s.sufix||s.prefix?(d.sufix=s.sufix,d.prefix=s.prefix,i[o]||(i[o]=[]),i[o].push(d)):(t[o]||(t[o]=[]),t[o].push(d))}})});try{n=function y(p){return p.replace(/<ruby>(.*?)<\/ruby>/gs,(e,t)=>{if(t.indexOf("</rt><span>")>0){console.info(t);const l=[],r=[],x=Array.from(t.matchAll(/<rt>(.*?)<\/rt>|<span>(.*?)<\/span>/gs));for(const c of x)void 0!==c[1]?l.push(c[1]):void 0!==c[2]&&r.push(c[2]);const s=l.length>0?`<rt>${l.join("")}</rt>`:"";return`<ruby>${r.length>0?`<span>${r.join("")}</span>`:""}${s}</ruby>`}return e})}(n);for(let r=t.length;r>=0;--r)t[r]&&([n,e]=m(t[r],n,e));for(let r=i.length;r>=0;--r)i[r]&&([n,e]=E(i[r],n,e));console.log("finished translation")}catch(r){console.error("TIMEOUT",r)}const g="\\][0-9]+\\]",l="\\[[0-9]+\\[";try{let r=new RegExp("("+g+l+")+","gm");e=e.replace(r," "),n=n.replace(r," "),r=new RegExp("("+g+")+","gm"),e=e.replace(r,""),n=n.replace(r,""),r=new RegExp("("+l+")+","gm"),e=e.replace(r,""),n=n.replace(r,"")}catch(r){console.info(g+l),console.error(r)}}postMessage({text:n,title:e})})})();