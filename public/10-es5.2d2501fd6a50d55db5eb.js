!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{z3cj:function(i,n,o){"use strict";o.r(n),o.d(n,"EntryModule",(function(){return A}));var r=o("ofXK"),a=o("tyNb"),s=o("yTNM"),c=o("b/G4"),l=o("3Pt+"),b=o("fXoL"),u=o("P6Fj"),d=o("o4Jw");function y(t,e){if(1&t&&(b.Ob(0,"tr"),b.Ob(1,"td"),b.oc(2),b.Nb(),b.Ob(3,"td"),b.oc(4),b.Nb(),b.Ob(5,"td"),b.oc(6),b.Nb(),b.Nb()),2&t){var i=e.$implicit;b.yb(2),b.pc(i[0]),b.yb(2),b.pc(i[1]),b.yb(2),b.pc(i[2])}}function h(t,e){if(1&t&&(b.Ob(0,"table",18),b.Ob(1,"thead"),b.Ob(2,"tr"),b.Ob(3,"th"),b.oc(4,"Original"),b.Nb(),b.Ob(5,"th"),b.oc(6,"Translated"),b.Nb(),b.Ob(7,"th"),b.oc(8,"Description"),b.Nb(),b.Nb(),b.Nb(),b.Ob(9,"tbody"),b.mc(10,y,7,3,"tr",17),b.Nb(),b.Nb()),2&t){var i=b.Xb();b.yb(10),b.ac("ngForOf",i.tmpResult)}}function p(t,e){if(1&t){var i=b.Pb();b.Ob(0,"div",2),b.Ob(1,"div",3),b.Ob(2,"a",19),b.Vb("click",(function(){return b.ic(i),b.Xb().openModal("import-list")})),b.oc(3,"Import List"),b.Nb(),b.Nb(),b.Nb()}}function f(t,e){if(1&t){var i=b.Pb();b.Ob(0,"div",2),b.Ob(1,"div",3),b.Ob(2,"button",19),b.Vb("click",(function(){return b.ic(i),b.Xb().submitForm()})),b.oc(3,"Save"),b.Nb(),b.Nb(),b.Ob(4,"div",3),b.Ob(5,"a",19),b.Vb("click",(function(){return b.ic(i),b.Xb().addItem()})),b.oc(6,"Add Entry"),b.Nb(),b.Nb(),b.Nb()}}function g(t,e){1&t&&b.Kb(0)}function m(t,e){if(1&t&&(b.Ob(0,"option",33),b.oc(1),b.Nb()),2&t){var i=e.$implicit;b.bc("value",i.id),b.yb(1),b.pc(i.name)}}var v=function(t,e,i){return{new:t,deleted:e,changed:i}};function O(t,e){if(1&t&&(b.Mb(0),b.Ob(1,"tr",20),b.Ob(2,"td"),b.Ob(3,"select",21),b.mc(4,m,2,2,"option",22),b.Nb(),b.Nb(),b.Ob(5,"td"),b.Jb(6,"input",23),b.Jb(7,"input",24),b.Jb(8,"input",25),b.Nb(),b.Ob(9,"td"),b.Jb(10,"input",26),b.Nb(),b.Ob(11,"td"),b.Jb(12,"textarea",27),b.Nb(),b.Ob(13,"td"),b.Ob(14,"label",28),b.Jb(15,"i",29),b.Jb(16,"input",30),b.Nb(),b.Nb(),b.Ob(17,"td"),b.Ob(18,"label",28),b.Jb(19,"i",31),b.Jb(20,"input",32),b.Nb(),b.Nb(),b.Nb(),b.Lb()),2&t){var i=e.$implicit,n=e.index,o=b.Xb();b.yb(1),b.ac("formGroupName",n)("ngClass",b.fc(3,v,0==i.controls.id.value,1==i.controls.delete.value,1==i.controls.update.value)),b.yb(3),b.ac("ngForOf",o.categories)}}function N(t,e){1&t&&b.Kb(0)}var C,k,F,w=[{path:"",component:(C=function(){function i(e,n,o,r,a,s){t(this,i),this.router=e,this.route=n,this.api=o,this.formBuilder=r,this.modalService=a,this.papa=s,this.entries=[],this.categories=[],this.tmpResult=[]}var n,o,r;return n=i,(o=[{key:"ngOnInit",value:function(){var t=this;this.idNovel=this.route.snapshot.params.idNovel,this.idDictionary=this.route.snapshot.params.idDictionary,this.idCategory=this.route.snapshot.params.idCategory,this.novel=this.api.Novel(this.idNovel),this.dictionary=this.api.Dictionary(this.idNovel,this.idDictionary),this.categories=Object.values(this.api.Categories(this.idDictionary)),this.entryForm=this.formBuilder.group({idCategory:"",entries:this.formBuilder.array([this.createItem()])}),this.novel?this.dictionaryList():this.api.getNovel(this.idNovel).subscribe((function(e){t.novel=t.api.Novel(t.idNovel),t.dictionaryList()}),(function(t){console.log(t)}))}},{key:"ngOnDestroy",value:function(){delete this.entries,delete this.novel,delete this.dictionary,delete this.categories,delete this.entries2Save,delete this.entryForm,delete this.entryArray,delete this.idCategory,delete this.idDictionary,delete this.idNovel,console.log("DESTROY!")}},{key:"dictionaryList",value:function(){var t=this;this.dictionary?this.categoryList():this.api.getDictionaries(this.idNovel).subscribe((function(e){t.dictionary=t.api.Dictionary(t.idNovel,t.idDictionary),t.categoryList()}),(function(t){console.log(t)}))}},{key:"categoryList",value:function(){var t=this;this.categories.length?this.entryList():this.api.getCategories(this.idNovel,this.idDictionary).subscribe((function(e){t.categories=Object.values(t.api.Categories(t.idDictionary)),t.entryList()}),(function(t){console.log(t)}))}},{key:"entryList",value:function(){var t=this;this.api.getEntries(this.idDictionary,this.idCategory).subscribe((function(e){t.entries=Object.values(t.api.Entries(t.idCategory)),t.fillForm()}),(function(t){console.log(t)}))}},{key:"createItem",value:function(){var t=this.formBuilder.group({id:"",idCategory:this.idCategory,entryOriginal:"",entryTranslation:"",description:"",update:"",delete:"",reset:""});return this.entryArray&&this.onChanges(t,this.entryArray.length),t}},{key:"addItem",value:function(){this.entryArray=this.entryForm.get("entries");var t=this.createItem();this.entryArray.push(t)}},{key:"onChanges",value:function(t,e){var i,n=this,o=!1,r=0;t.valueChanges.subscribe((function(a){if(0===r)if(console.log(a),i||(i=n.api.Entry(n.idCategory,a.id),console.log(i)),a.reset&&(console.log("reset"),r=6,t.controls.reset.setValue(!1),t.controls.update.setValue(!1),t.controls.delete.setValue(!1),t.controls.idCategory.setValue(a.id?i.idCategory:""),t.controls.entryOriginal.setValue(a.id?i.entryOriginal:""),t.controls.entryTranslation.setValue(a.id?i.entryTranslation:""),t.controls.description.setValue(a.id?i.description:"")),a.id){var s=a.idCategory!=i.idCategory||a.entryOriginal!=i.entryOriginal||a.entryTranslation!=i.entryTranslation||a.description!=i.description||a.delete!=o;s!=a.update&&(r=1,t.controls.update.setValue(s)),a.delete&&(o=a.delete)}else a.delete&&n.entryArray.removeAt(e);else console.log("counter",r),--r}))}},{key:"fillForm",value:function(){this.entryForm.patchValue({idCategory:this.idCategory}),this.entryForm.setControl("entries",this.setExistingEntries(this.entries)),this.addItem()}},{key:"setExistingEntries",value:function(t){var e=this,i=new l.c([]),n=null;return t.forEach((function(t){n=e.formBuilder.group({id:t.id,idCategory:t.idCategory,entryOriginal:t.entryOriginal,entryTranslation:t.entryTranslation,description:t.description,update:!1,delete:!1,reset:!1}),e.onChanges(n,i.length),i.push(n)})),this.entryArray=i,i}},{key:"submitForm",value:function(){var t=this;console.log(this.entryForm.value),this.api.addEntries(this.idDictionary,this.idCategory,this.entryForm.value).subscribe((function(e){e.changes?t.api.getEntries(t.idDictionary,t.idCategory).subscribe((function(e){t.router.navigate(["/novel/dictionary/",t.idNovel,t.idDictionary])}),(function(t){console.log("Didn't move because: ",t)})):t.router.navigate(["/novel/dictionary/",t.idNovel,t.idDictionary])}),(function(t){console.log(t)}))}},{key:"openModal",value:function(t){this.modalService.open(t)}},{key:"closeModal",value:function(t){this.modalService.close(t)}},{key:"uploadFile",value:function(t){var e=this;this.file=t.target.files[0];var i=new FileReader;i.onload=function(t){e.papa.parse(i.result,{complete:function(t){e.tmpResult=t.data,e.openModal("confirm-import")}})},i.readAsText(this.file)}},{key:"cancelImport",value:function(){this.tmpResult=[],this.closeModal("confirm-import")}},{key:"commitImport",value:function(){var t,e=this;for(t=this.entryArray.value.length-1;t>-1;--t)if(""!=this.entryArray.value[t].id||""!=this.entryArray.value[t].idCategory||""!=this.entryArray.value[t].entryOriginal||""!=this.entryArray.value[t].entryTranslation||""!=this.entryArray.value[t].description){++t;break}this.tmpResult.forEach((function(i){var n=e.formBuilder.group({id:"",idCategory:e.idCategory,entryOriginal:i[0],entryTranslation:i[1],description:i[2],update:!1,delete:!1,reset:!1});e.entryArray.controls[t]?(e.onChanges(n,t),e.entryArray.controls[t]=n):(e.onChanges(n,e.entryArray.length),e.entryArray.push(n)),++t})),this.entryArray.controls[t]||this.addItem(),this.closeModal("confirm-import"),this.closeModal("import-list")}}])&&e(n.prototype,o),r&&e(n,r),i}(),C.\u0275fac=function(t){return new(t||C)(b.Ib(a.c),b.Ib(a.a),b.Ib(s.a),b.Ib(l.e),b.Ib(c.a),b.Ib(u.a))},C.\u0275cmp=b.Cb({type:C,selectors:[["app-list"]],hostBindings:function(t,e){1&t&&b.Vb("blur",(function(t){return e.onBlur(t)}))},decls:60,vars:5,consts:[["id","import-list"],[1,"h1"],[1,"columns","actionButtons"],[1,"column"],[1,"button","is-primary"],["type","file",1,"hidden",3,"change"],[1,"button","is-danger",3,"click"],["id","confirm-import"],["class","table",4,"ngIf"],[1,"button","is-primary",3,"click"],["actionButtons",""],["footerButtons",""],[4,"ngTemplateOutlet"],["id","entryForm",3,"formGroup","submit"],["type","hidden","formControlName","idCategory"],[1,"table","is-stripede","is-fullwidth"],["formArrayName","entries",1,"tableContent"],[4,"ngFor","ngForOf"],[1,"table"],[1,"button","is-info",3,"click"],[3,"formGroupName","ngClass"],["formControlName","idCategory"],[3,"value",4,"ngFor","ngForOf"],["formControlName","id","type","hidden"],["formControlName","update","type","hidden"],["formControlName","entryOriginal","type","text",1,"input"],["formControlName","entryTranslation","type","text",1,"input"],["formControlName","description","rows","1",1,"textarea"],[1,"icon","is-large"],[1,"fas","fa-exclamation-triangle"],["formControlName","reset","type","checkbox",1,"hidden"],[1,"fas","fa-times"],["formControlName","delete","type","checkbox",1,"hidden"],[3,"value"]],template:function(t,e){if(1&t&&(b.Ob(0,"jw-modal",0),b.Ob(1,"h1",1),b.oc(2,"Importing a file"),b.Nb(),b.Ob(3,"p"),b.Ob(4,"b"),b.oc(5,"File type"),b.Nb(),b.oc(6,": CSV"),b.Nb(),b.Ob(7,"p"),b.Ob(8,"b"),b.oc(9,"Columns"),b.Nb(),b.oc(10,': "Original";"Translated";"Description"'),b.Nb(),b.Ob(11,"p"),b.Ob(12,"b"),b.oc(13,"Instructions"),b.Nb(),b.oc(14,": Select the file and the imported data will be shown below before they are commited to the main screen. In case of error, check the file through a normal text editor and see if it follows the above style. Also, there is no header, so in case your file has it, you can manually delete it later "),b.Nb(),b.Ob(15,"div",2),b.Ob(16,"div",3),b.Ob(17,"label",4),b.oc(18," Select File "),b.Ob(19,"input",5),b.Vb("change",(function(t){return e.uploadFile(t)})),b.Nb(),b.Nb(),b.Nb(),b.Ob(20,"div",3),b.Ob(21,"button",6),b.Vb("click",(function(){return e.closeModal("import-list")})),b.oc(22,"Close"),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Ob(23,"jw-modal",7),b.Ob(24,"h1"),b.oc(25,"Is this what you were looking for?"),b.Nb(),b.mc(26,h,11,1,"table",8),b.Ob(27,"div",2),b.Ob(28,"div",3),b.Ob(29,"button",9),b.Vb("click",(function(){return e.commitImport()})),b.oc(30,"Yes"),b.Nb(),b.Nb(),b.Ob(31,"div",3),b.Ob(32,"button",6),b.Vb("click",(function(){return e.cancelImport()})),b.oc(33,"No"),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.mc(34,p,4,0,"ng-template",null,10,b.nc),b.mc(36,f,7,0,"ng-template",null,11,b.nc),b.mc(38,g,1,0,"ng-container",12),b.Ob(39,"div"),b.Ob(40,"form",13),b.Vb("submit",(function(){return e.submitForm()})),b.Jb(41,"input",14),b.Ob(42,"table",15),b.Ob(43,"thead"),b.Ob(44,"tr"),b.Ob(45,"th"),b.oc(46,"Category"),b.Nb(),b.Ob(47,"th"),b.oc(48,"Original"),b.Nb(),b.Ob(49,"th"),b.oc(50,"Translated"),b.Nb(),b.Ob(51,"th"),b.oc(52,"Description"),b.Nb(),b.Ob(53,"th"),b.oc(54,"Reset"),b.Nb(),b.Ob(55,"th"),b.oc(56,"Delete"),b.Nb(),b.Nb(),b.Nb(),b.Ob(57,"tbody",16),b.mc(58,O,21,7,"ng-container",17),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.mc(59,N,1,0,"ng-container",12)),2&t){var i=b.hc(35),n=b.hc(37);b.yb(26),b.ac("ngIf",e.tmpResult.length),b.yb(12),b.ac("ngTemplateOutlet",i),b.yb(2),b.ac("formGroup",e.entryForm),b.yb(18),b.ac("ngForOf",e.entryForm.get("entries").controls),b.yb(1),b.ac("ngTemplateOutlet",n)}},directives:[d.a,r.j,r.n,l.q,l.k,l.g,l.b,l.j,l.f,l.d,r.i,l.h,r.h,l.o,l.a,l.m,l.p],styles:[".actionButtons[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%], .actionButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;width:100%}.hidden[_ngcontent-%COMP%]{display:none}.tableContent[_ngcontent-%COMP%]   .changed[_ngcontent-%COMP%]{background-color:green}.tableContent[_ngcontent-%COMP%]   .new[_ngcontent-%COMP%]{background-color:#00f}.tableContent[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{background-color:red}"]}),C),data:{title:"List Entries"}},{path:"**",redirectTo:""}],I=((F=function e(){t(this,e)}).\u0275mod=b.Gb({type:F}),F.\u0275inj=b.Fb({factory:function(t){return new(t||F)},imports:[[a.g.forChild(w)],a.g]}),F),A=((k=function e(){t(this,e)}).\u0275mod=b.Gb({type:k}),k.\u0275inj=b.Fb({factory:function(t){return new(t||k)},imports:[[r.b,I,l.i,l.n]]}),k)}}])}();