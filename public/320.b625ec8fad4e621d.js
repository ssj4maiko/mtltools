"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[320],{3320:(nt,x,d)=>{d.r(x),d.d(x,{ChapterModule:()=>X});var p=d(6895),_=d(4793),M=d(2340),t=d(4650),C=d(6845);function m(o,a){1&o&&(t.TgZ(0,"div",5)(1,"a",8),t._uU(2,"Import Chapter"),t.qZA()())}function P(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"a",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).updateChapters()}),t._uU(2,"Update Chapters"),t.qZA()()}}const T=function(o){return["/novel/",o,"dictionary"]};function b(o,a){if(1&o&&(t.TgZ(0,"div",4)(1,"div",5)(2,"a",6),t._uU(3,"Dictionary"),t.qZA()(),t.YNc(4,m,3,0,"div",7),t.YNc(5,P,3,0,"div",7),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("routerLink",t.VKq(3,T,e.idNovel)),t.xp6(2),t.Q6J("ngIf",e.novel&&"manual"==e.novel.driver),t.xp6(1),t.Q6J("ngIf",e.novel&&"manual"!=e.novel.driver)}}function w(o,a){1&o&&t.GkF(0)}function Z(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"a",15),t.NdJ("click",function(){const r=t.CHM(e).$implicit,c=t.oxw().$implicit;return t.oxw().openGT(c,r)}),t._uU(1),t.qZA()}if(2&o){const e=a.$implicit;t.xp6(1),t.Oqu(e.language)}}function k(o,a){1&o&&(t.TgZ(0,"a",16)(1,"span",17),t._UZ(2,"i",18),t.qZA()())}function N(o,a){1&o&&(t.TgZ(0,"a",19)(1,"span",17),t._UZ(2,"i",20),t.qZA()())}const u=function(o,a){return["/novel/",o,a]};function S(o,a){if(1&o&&(t.ynx(0),t.TgZ(1,"tr",10)(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td",11),t._uU(5),t.qZA(),t.TgZ(6,"td",11),t._uU(7),t.qZA(),t.TgZ(8,"td",11),t._uU(9),t.qZA(),t.TgZ(10,"td"),t.YNc(11,Z,2,1,"a",12),t.qZA(),t.YNc(12,k,3,0,"ng-template",null,13,t.W1O),t.YNc(14,N,3,0,"ng-template",null,14,t.W1O),t.qZA(),t.BQk()),2&o){const e=a.$implicit,i=t.oxw();t.xp6(1),t.s9C("title",i.novel.title),t.xp6(2),t.Oqu(e.no),t.xp6(1),t.Q6J("routerLink",t.WLB(9,u,e.idNovel,e.no)),t.xp6(1),t.Oqu(e.title),t.xp6(1),t.Q6J("routerLink",t.WLB(12,u,e.idNovel,e.no)),t.xp6(1),t.Oqu(e.dateOriginalPost),t.xp6(1),t.Q6J("routerLink",t.WLB(15,u,e.idNovel,e.no)),t.xp6(1),t.Oqu(e.dateOriginalRevision),t.xp6(2),t.Q6J("ngForOf",i.dictionaries)}}let E=(()=>{class o{constructor(e,i,n){this.router=e,this.route=i,this.api=n,this.chapters=[],this.dictionaries=[]}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.api.Novel.get({id:this.idNovel}).then(e=>{this.novel=e,this.api.Dictionary.getAll({idNovel:this.idNovel}).then(i=>{this.dictionaries=Object.values(i),this.api.Chapter.getAll({idNovel:this.idNovel}).then(n=>{this.chapters=Object.values(n)})})})}openGT(e,i){let n=`${M.N.backendServer}/static/${this.idNovel}/${i.id}/${e.no}/1`;n="https://translate.google.com/translate?sl=auto&tl=en&u="+n,window.open(n)}updateChapters(){this.api.Chapter.autoUpdate({idNovel:this.idNovel}).then(e=>{this.api.Chapter.getAll({idNovel:this.idNovel}).then(i=>{this.chapters=Object.values(i)})},e=>{console.log(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.F0),t.Y36(_.gz),t.Y36(C.s))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-chapter-list"]],decls:21,vars:2,consts:[["actionButtons",""],[4,"ngTemplateOutlet"],[1,"table","is-striped","is-hoverable","is-fullwidth"],[4,"ngFor","ngForOf"],[1,"columns","actionButtons"],[1,"column"],[1,"button","is-primary",3,"routerLink"],["class","column",4,"ngIf"],["routerLink","['/novel/',idNovel,'add']",1,"button","is-info"],[1,"button","is-info",3,"click"],[3,"title"],[3,"routerLink"],[3,"click",4,"ngFor","ngForOf"],["success",""],["danger",""],[3,"click"],[1,"button","is-success"],[1,"icon","is-small"],[1,"fas","fa-check"],[1,"button","is-danger"],[1,"fas","fa-times"]],template:function(e,i){if(1&e&&(t.YNc(0,b,6,5,"ng-template",null,0,t.W1O),t.YNc(2,w,1,0,"ng-container",1),t.TgZ(3,"div")(4,"table",2)(5,"thead")(6,"tr")(7,"th"),t._uU(8,"Number"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Title"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Date Created"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Date Updated"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Dictionary"),t._UZ(17,"br"),t._uU(18,"Google Translator"),t.qZA()()(),t.TgZ(19,"tbody"),t.YNc(20,S,16,18,"ng-container",3),t.qZA()()()),2&e){const n=t.MAs(1);t.xp6(2),t.Q6J("ngTemplateOutlet",n),t.xp6(18),t.Q6J("ngForOf",i.chapters)}},directives:[_.yS,p.O5,p.tP,p.sg,_.rH],styles:[".actionButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;width:100%}"]}),o})();var y=d(3178),L=d(2414);let J=(()=>{class o{constructor(e){this.api=e,this.categories=[],this.categoriesOriginalValues=[],this.indexes=[]}rebuildCache(e){this.api.Category.getAll({idDictionary:this.idDictionary}).then(i=>{this.categories=Object.values(i);const n=[];this.categories.forEach((r,c)=>{n.push(new Promise((l,g)=>{this.api.Entry.getAll({idDictionary:this.idDictionary,idCategory:r.id}).then(tt=>{n.push(new Promise((et,it)=>{r.entries=Object.values(tt),et()}))}),l()}))}),Promise.all(n).then(r=>{this.categoriesOriginalValues=JSON.parse(JSON.stringify(this.categories)),e()})})}addEntry(e,i,n){e.entries||(e.entries=[]),e.entries.push(new y.y),setTimeout(()=>{let r,c;if(this.DOMcategories){let l=this.DOMcategories.toArray()[n];l&&(r=l.nativeElement)}r||(r=document.getElementById("categoryDOM-"+n)),c=r.children[r.children.length-2].children[0],c.focus()},150)}addCategory(){this.categories.push(new L.c(null,this.idDictionary))}changeEntry(e,i,n){e.reset?this.categories[i].entries[n]=this.categories[i].entries[n].id?new y.y(this.categoriesOriginalValues[i].entries[n]):new y.y(null,this.categories[i].id):e.delete?e.id||this.categories[i].entries.splice(n,1):e.id&&(e.update=e.entryOriginal!==this.categoriesOriginalValues[i].entries[n].entryOriginal||e.entryTranslation!==this.categoriesOriginalValues[i].entries[n].entryTranslation||e.description!==this.categoriesOriginalValues[i].entries[n].description||e.idCategory!==this.categoriesOriginalValues[i].entries[n].idCategory)}changeCategory(e,i){e.id&&(e.update=e.name!==this.categoriesOriginalValues[i].name)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(C.s))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var s=d(4873),h=d(4006);function A(o,a){if(1&o&&(t.TgZ(0,"option",24),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.language)}}function D(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"li",18)(1,"select",19),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).dictionarySelector=n})("change",function(n){return t.CHM(e),t.oxw(2).dictionarySelected(n.target.value)}),t.TgZ(2,"option",20),t._uU(3,"Choose a language"),t.qZA(),t.YNc(4,A,2,2,"option",21),t.qZA(),t.TgZ(5,"input",22),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).refreshTranslation()}),t.qZA(),t.TgZ(6,"input",23),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).refreshOriginal()}),t.qZA()()}if(2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngModel",e.dictionarySelector),t.xp6(3),t.Q6J("ngForOf",e.dictionaries)}}const B=function(o,a,e){return{changed:o,new:a,"category-selected":e}};function q(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"li")(2,"h1",25),t.NdJ("click",function(){const r=t.CHM(e).index;return t.oxw(2).selectOpenCategory=r}),t.TgZ(3,"input",26),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.name=n})("ngModelChange",function(){const n=t.CHM(e),r=n.$implicit,c=n.index;return t.oxw(2).changeCategory(r,c)}),t.qZA()()(),t.BQk()}if(2&o){const e=a.$implicit,i=a.index,n=t.oxw(2);t.xp6(2),t.Q6J("ngClass",t.kEZ(3,B,1==e.update,null==e.id,n.selectOpenCategory==i)),t.xp6(1),t.MGl("id","category-",i,""),t.Q6J("ngModel",e.name)}}const F=function(o,a,e){return{changed:o,deleted:a,new:e}};function Q(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"div",32)(1,"input",33,34),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.entryOriginal=n})("focus",function(){const r=t.CHM(e).index;return t.oxw(3).selectedEntry=r})("ngModelChange",function(){const n=t.CHM(e),r=n.$implicit,c=n.index,l=t.oxw().index;return t.oxw(2).changeEntry(r,l,c)}),t.qZA(),t.TgZ(3,"input",35),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.entryTranslation=n})("focus",function(){const r=t.CHM(e).index;return t.oxw(3).selectedEntry=r})("ngModelChange",function(){const n=t.CHM(e),r=n.$implicit,c=n.index,l=t.oxw().index;return t.oxw(2).changeEntry(r,l,c)}),t.qZA(),t.TgZ(4,"input",36),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.description=n})("focus",function(){const r=t.CHM(e).index;return t.oxw(3).selectedEntry=r})("ngModelChange",function(){const n=t.CHM(e),r=n.$implicit,c=n.index,l=t.oxw().index;return t.oxw(2).changeEntry(r,l,c)}),t.qZA(),t.TgZ(5,"label",37),t._UZ(6,"i",38),t.TgZ(7,"input",39),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.delete=n})("change",function(){const n=t.CHM(e),r=n.$implicit,c=n.index,l=t.oxw().index;return t.oxw(2).changeEntry(r,l,c)}),t.qZA()(),t.TgZ(8,"label",40),t._UZ(9,"i",41),t.TgZ(10,"input",42),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.reset=n})("change",function(){const n=t.CHM(e),r=n.$implicit,c=n.index,l=t.oxw().index;return t.oxw(2).changeEntry(r,l,c)}),t.qZA()(),t.TgZ(11,"input",43),t.NdJ("ngModelChange",function(n){return t.CHM(e).$implicit.idCategory=n}),t.qZA()()}if(2&o){const e=a.$implicit,i=a.index,n=t.oxw().index;t.Q6J("ngClass",t.kEZ(13,F,1==e.update,1==e.delete,null==e.id)),t.xp6(1),t.hYB("id","entry-",n,"-",i,""),t.Q6J("ngModel",e.entryOriginal),t.xp6(2),t.hYB("id","entry-",n,"-",i,"-trans"),t.Q6J("ngModel",e.entryTranslation),t.xp6(1),t.hYB("id","entry-",n,"-",i,"-desc"),t.Q6J("ngModel",e.description),t.xp6(3),t.Q6J("ngModel",e.delete),t.xp6(3),t.Q6J("ngModel",e.reset),t.xp6(1),t.Q6J("ngModel",e.idCategory)}}const f=function(o){return{hidden:o}};function H(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"li",16)(2,"div",27,28),t.YNc(4,Q,12,17,"div",29),t._UZ(5,"div",30),t.qZA(),t.TgZ(6,"input",31),t.NdJ("click",function(){const n=t.CHM(e),r=n.$implicit,c=n.index;return t.oxw(2).addEntry(r,r.id,c)}),t.qZA()(),t.BQk()}if(2&o){const e=a.$implicit,i=a.index,n=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(3,f,n.selectOpenCategory!=i)),t.xp6(1),t.MGl("id","categoryDOM-",i,""),t.xp6(2),t.Q6J("ngForOf",e.entries)}}function U(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"div",3)(1,"ul"),t.YNc(2,D,7,2,"li",4),t.qZA(),t.TgZ(3,"ul")(4,"li",5)(5,"input",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().saveModifications()}),t.qZA(),t.TgZ(6,"input",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().openOutside(!0)}),t.qZA(),t.TgZ(7,"input",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().openOutside(!1)}),t.qZA()()(),t.TgZ(8,"div",9)(9,"ul",10),t.YNc(10,q,4,7,"ng-container",11),t.TgZ(11,"li")(12,"h1",12)(13,"input",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().addCategory()}),t.qZA()()()(),t.TgZ(14,"div",14)(15,"ul",15)(16,"li",16)(17,"p",17),t._uU(18," <- Select a category "),t.qZA()(),t.YNc(19,H,7,5,"ng-container",11),t.qZA()()(),t.TgZ(20,"ul")(21,"li",5)(22,"input",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().saveModifications()}),t.qZA(),t.TgZ(23,"input",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().openOutside(!0)}),t.qZA(),t.TgZ(24,"input",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().openOutside(!1)}),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.dictionaries.length>0),t.xp6(3),t.Q6J("disabled",e.saving),t.xp6(5),t.Q6J("ngForOf",e.categories),t.xp6(6),t.Q6J("ngClass",t.VKq(6,f,e.selectOpenCategory>=0)),t.xp6(3),t.Q6J("ngForOf",e.categories),t.xp6(3),t.Q6J("disabled",e.saving)}}let v=(()=>{class o extends J{constructor(e,i){super(e),this.api=e,this.route=i,this.Sidebar2Chapter=new t.vpe,this.dictionaries=[],this.categories=[],this.dictionarySelector="",this.shortcuts=[],this.selectOpenCategory=-1,this.selectedEntry=-1,this.getSelectedEntryType=n=>n.indexOf("trans")>0?"-trans":n.indexOf("desc")>0?"-desc":"",this.moveFocus=(n,r,c)=>{let l=document.getElementById(n);l?l.focus():console.error(n)},this.saving=!1}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.api.Dictionary.getAll({idNovel:this.idNovel}).then(e=>{this.dictionaries=e,this.dictionarySelector=e[0].id,this.dictionarySelected(this.dictionarySelector)})}ngAfterViewInit(){this.shortcuts.push({key:["ctrl + up","ctrl + alt + up"],preventDefault:!0,label:"Categories",description:"Category Up",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{this.selectedEntry=-1,this.selectOpenCategory>0?this.selectOpenCategory--:this.selectOpenCategory=this.categories.length-1,this.moveFocus("category-"+this.selectOpenCategory,"CUp",e)}},{key:["ctrl + down","ctrl + alt + down"],preventDefault:!0,label:"Categories",description:"Category Down",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{this.selectedEntry=-1,this.selectOpenCategory<this.categories.length-1?this.selectOpenCategory++:this.selectOpenCategory=0,this.moveFocus("category-"+this.selectOpenCategory,"CDown",e)}},{key:"ctrl + alt + plus",preventDefault:!0,label:"Categories",description:"Add New Category",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{this.addCategory(),this.selectOpenCategory=this.categories.length-1;let i="category-"+this.selectOpenCategory;setTimeout(()=>{this.moveFocus(i,"CNew",e)},100)}},{key:"alt + down",preventDefault:!0,label:"Entries",description:"Move Down on Entry List",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{if(this.selectOpenCategory<0&&(this.selectOpenCategory=0),this.categories[this.selectOpenCategory].entries){this.selectedEntry>=this.categories[this.selectOpenCategory].entries.length-1?this.selectedEntry=0:this.selectedEntry++;let i=e.event.target.id?this.getSelectedEntryType(e.event.target.id):"";this.moveFocus("entry-"+this.selectOpenCategory+"-"+this.selectedEntry+i,"EDown",e)}}},{key:"alt + up",preventDefault:!0,label:"Entries",description:"Move Up on Entry List",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{if(this.selectOpenCategory<0&&(this.selectOpenCategory=0),this.categories[this.selectOpenCategory].entries){this.selectedEntry<=0?this.selectedEntry=this.categories[this.selectOpenCategory].entries.length-1:this.selectedEntry--;let i=e.event.target.id?this.getSelectedEntryType(e.event.target.id):"";this.moveFocus("entry-"+this.selectOpenCategory+"-"+this.selectedEntry+i,"EUp",e)}}},{key:"alt + right",preventDefault:!0,label:"Entries",description:"Move Right on Entry List",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{if(this.selectOpenCategory<0||!this.categories[this.selectOpenCategory].entries||0!==e.event.target.id.indexOf("entry-"))return;let i=e.event.target.id?this.getSelectedEntryType(e.event.target.id):"";switch(i){case"":i="-trans";break;case"-trans":i="-desc"}this.moveFocus("entry-"+this.selectOpenCategory+"-"+this.selectedEntry+i,"ERight",e)}},{key:"alt + left",preventDefault:!0,label:"Entries",description:"Move Left on Entry List",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{if(this.selectOpenCategory<0||!this.categories[this.selectOpenCategory].entries||0!==e.event.target.id.indexOf("entry-"))return;let i=e.event.target.id?this.getSelectedEntryType(e.event.target.id):"";switch(i){case"-trans":i="";break;case"-desc":i="-trans"}this.moveFocus("entry-"+this.selectOpenCategory+"-"+this.selectedEntry+i,"ERight",e)}},{key:"alt + plus",preventDefault:!0,label:"Entries",description:"Add New Entry",allowIn:[s.Mv.ContentEditable,s.Mv.Input,s.Mv.Select,s.Mv.Textarea],command:e=>{if(this.selectOpenCategory<0)return;this.addEntry(this.categories[this.selectOpenCategory],this.categories[this.selectOpenCategory].id,this.selectOpenCategory),this.selectedEntry=this.categories[this.selectOpenCategory].entries.length-1;let i="entry-"+this.selectOpenCategory+"-"+this.selectedEntry;setTimeout(()=>{this.moveFocus(i,"ENew",e)},100)}})}ngOnDestroy(){delete this.dictionaries,delete this.categories,delete this.categoriesOriginalValues,delete this.idCategory,delete this.idDictionary,delete this.idNovel,delete this.dictionarySelector,console.log("destroy Sidebar")}dictionarySelected(e){this.idDictionary=e,this.getCache()}getCache(){0===this.categories.length?this.api.Dictionary.getCache(this.idDictionary).then(e=>{this.PrepareCacheThenTranslate(e)}):this.refreshTranslation()}PrepareCacheThenTranslate(e){e&&new Promise((n,r)=>{this.rebuildCache(n)}).then(n=>{this.refreshTranslation()})}refreshTranslation(){this.Sidebar2Chapter.emit(this.categories)}refreshOriginal(){this.Sidebar2Chapter.emit([])}saveModifications(){this.saving=!0,this.api.Dictionary.fullSave(this.idDictionary,this.categories).then(e=>{this.categories=[],this.getCache(),this.refreshTranslation(),this.saving=!1,console.log("saveModifications",e)})}openOutside(e){let n=`${M.N.backendServer}/static/${this.idNovel}/${this.idDictionary}/${this.route.snapshot.params.noChapter}/`;e&&(n="https://translate.google.com/translate?sl=auto&tl=en&u="+n),window.open(n)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(C.s),t.Y36(_.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-chapter-sidebar"]],viewQuery:function(e,i){if(1&e&&t.Gf(s.xj,5),2&e){let n;t.iGM(n=t.CRH())&&(i.keyboard=n.first)}},outputs:{Sidebar2Chapter:"Sidebar2Chapter"},features:[t.qOj],decls:3,vars:4,consts:[["class","dictionaryList",4,"ngIf"],[3,"shortcuts"],[3,"key","title"],[1,"dictionaryList"],["class","dictionary-selector",4,"ngIf"],[1,"dictionary-buttons"],["type","button","value","Save Modifications",1,"button","is-small","is-danger",3,"disabled","click"],["type","button","value","Google Translate",1,"button","is-small","is-info",3,"click"],["type","button","value","Open Keyword Translated Raw",1,"button","is-small","is-warning",3,"click"],[1,"interactiveBox"],[1,"categories"],[4,"ngFor","ngForOf"],[1,"categoryButtonRow"],["type","button","value","+ Add new Category",1,"button","is-small","is-primary",3,"click"],[1,"entries"],[1,"entries-container"],[3,"ngClass"],[1,"hint"],[1,"dictionary-selector"],[1,"select",3,"ngModel","ngModelChange","change"],["value","","selected","selected"],[3,"value",4,"ngFor","ngForOf"],["type","button","value","Refresh Translation",1,"button","is-small","is-info",3,"click"],["type","button","value","Refresh to Original",1,"button","is-small","is-warning",3,"click"],[3,"value"],[3,"ngClass","click"],["type","text","placeholder","Category Name",1,"category-name",3,"ngModel","id","ngModelChange"],[1,"category-entry-container",3,"id"],["categoryDOM",""],["class","entry",3,"ngClass",4,"ngFor","ngForOf"],[1,"entry-spacer"],["type","button","value","+ Add new Entry",1,"addNewEntryButton",3,"click"],[1,"entry",3,"ngClass"],["type","text","placeholder","Original",1,"entry-original",3,"ngModel","id","ngModelChange","focus"],["entry",""],["type","text","placeholder","Translation",1,"entry-translation",3,"ngModel","id","ngModelChange","focus"],["type","text","placeholder","Description",1,"entry-description",3,"ngModel","id","ngModelChange","focus"],[1,"deleteButton"],[1,"fas","fa-trash"],["type","checkbox","title","Delete",1,"hidden",3,"ngModel","ngModelChange","change"],[1,"resetButton"],[1,"fas","fa-sync-alt"],["type","checkbox","title","Reset",1,"hidden",3,"ngModel","ngModelChange","change"],["type","hidden",3,"ngModel","ngModelChange"]],template:function(e,i){1&e&&(t.YNc(0,U,25,8,"div",0),t._UZ(1,"ng-keyboard-shortcuts",1)(2,"ng-keyboard-shortcuts-help",2)),2&e&&(t.Q6J("ngIf",i.dictionaries.length>0),t.xp6(1),t.Q6J("shortcuts",i.shortcuts),t.xp6(1),t.Q6J("key","f1")("title","Help"))},directives:[p.O5,h.EJ,h.JJ,h.On,h.YN,h.Kr,p.sg,p.mk,h.Fj,h.Wl,s.xj,s.iD],styles:['.dictionaryList[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.dictionaryList[_ngcontent-%COMP%]   .dictionary-selector[_ngcontent-%COMP%]{align-self:flex-start;width:100%}.dictionaryList[_ngcontent-%COMP%]   .dictionary-selector[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.3%;height:100%}.dictionaryList[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{align-self:flex-end}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:500px;flex:1 1 auto}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]{color:#fff;background:rgba(255,255,255,.5);float:left;line-height:1.4;animation-duration:.5s;animation-name:categoriesHide;width:10%}@keyframes categoriesShow{0%{width:10%}to{width:30%}}@keyframes categoriesHide{0%{width:30%}to{width:10%}}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]:hover{animation-duration:.5s;animation-name:categoriesShow;width:30%}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{height:30px;width:100%;background:#2f0050}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   h1.changed[_ngcontent-%COMP%]{background:#009013}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   h1.new[_ngcontent-%COMP%]{background:#000063}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   h1.categoryButtonRow[_ngcontent-%COMP%]{background:#00d1b2}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   h1.categoryButtonRow[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   .category-name[_ngcontent-%COMP%]{background-color:transparent;border:0px solid white;color:#fff;outline-width:0px}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .categories[_ngcontent-%COMP%]   .category-selected[_ngcontent-%COMP%]{border-width:2px 0px 2px 5px;border-style:solid;border-color:red}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]{width:90%;height:100%;padding:left 10;float:left;overflow:hidden;z-index:1;background-color:#5e009f}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{background:black;color:#fff;height:100%}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]{height:100%}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{height:100%;position:relative;overflow-x:auto}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .category-entry-container[_ngcontent-%COMP%]{overflow-y:auto;height:100%;height:calc(100% - 30px)}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]{width:630px}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]:after{clear:both;content:"";display:block}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]:nth-child(odd){background-color:#555}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]:nth-child(even){background-color:#888}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry.changed[_ngcontent-%COMP%]{background-color:green}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry.new[_ngcontent-%COMP%]{background-color:#000063}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry.deleted[_ngcontent-%COMP%]{background-color:#480000}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:transparent;border:0px solid white;color:#fff}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry-original[_ngcontent-%COMP%]{width:100px;float:left}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry-translation[_ngcontent-%COMP%]{width:150px;float:left}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry-description[_ngcontent-%COMP%]{width:300px;float:left}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .deleteButton[_ngcontent-%COMP%]{color:red;margin:0 8px;float:left}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .resetButton[_ngcontent-%COMP%]{color:#00f;margin:0 8px;float:left}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .entry-spacer[_ngcontent-%COMP%]{height:200px}.dictionaryList[_ngcontent-%COMP%]   .interactiveBox[_ngcontent-%COMP%]   .entries[_ngcontent-%COMP%]   .entries-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .addNewEntryButton[_ngcontent-%COMP%]{position:absolute;bottom:0px;left:0px;width:100%;height:30px;text-align:left;border-width:2px 0;border-color:#009013;background-color:#000}.dictionaryList[_ngcontent-%COMP%]   .hidden[_ngcontent-%COMP%]{display:none}.dictionaryList[_ngcontent-%COMP%]   .dictionary-buttons[_ngcontent-%COMP%]{width:100%}.dictionaryList[_ngcontent-%COMP%]   .dictionary-buttons[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.3%;height:100%}']}),o})();var Y=d(1481);function R(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"a",14),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).chapterRoute.previous()}),t._uU(1," Previous "),t.qZA()}}function $(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"a",14),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).chapterRoute.next()}),t._uU(1," Next "),t.qZA()}}const j=function(o){return["/novel/",o]};function I(o,a){if(1&o&&(t.TgZ(0,"div",10)(1,"div",11),t.YNc(2,R,2,0,"a",12),t.qZA(),t.TgZ(3,"div",11)(4,"a",13),t._uU(5," Table of Contents "),t.qZA()(),t.TgZ(6,"div",11),t.YNc(7,$,2,0,"a",12),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.chapterPrevious),t.xp6(2),t.Q6J("routerLink",t.VKq(3,j,e.idNovel)),t.xp6(3),t.Q6J("ngIf",e.chapterNext)}}function V(o,a){1&o&&t.GkF(0)}function G(o,a){if(1&o&&(t.ynx(0),t.TgZ(1,"h1",15),t._uU(2),t.qZA(),t._UZ(3,"hr")(4,"div",16),t.BQk()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(e.renderedTitle),t.xp6(2),t.s9C("innerHTML",e.renderedText,t.oJD)}}function z(o,a){1&o&&t.GkF(0)}let O=(()=>{class o{constructor(e,i,n,r,c){this.router=e,this.route=i,this.sanitized=n,this.api=r,this.viewport=c,this.shortcuts=[],this.chapterRoute={next:()=>{this.viewport.scrollToPosition([0,0]),this.router.navigate(["novel",this.idNovel,this.chapterNext.no])},previous:()=>{this.viewport.scrollToPosition([0,0]),this.router.navigate(["novel",this.idNovel,this.chapterPrevious.no])}},this.showSidebar=!0}ngOnInit(){this.loadedChapter=new Promise(e=>{this.loadedChapterResolve=e}),this.startContent()}ngAfterViewInit(){this.shortcuts.push({key:"alt + pageup",preventDefault:!0,label:"Chapter",description:"Previous Chapter",command:e=>{this.chapterRoute.previous()}},{key:"alt + pagedown",preventDefault:!0,label:"Chapter",description:"Next Chapter",command:e=>{this.chapterRoute.next()}})}ngOnDestroy(){delete this.loadedChapter,console.log("destroy detailed chapter")}ngDoCheck(){this.noChapter!==this.route.snapshot.params.noChapter&&(console.log("changing chapter",this.Sidebar.categories),this.ngOnInit(),this.translateText(this.Sidebar.categories))}startContent(){this.idNovel=this.route.snapshot.params.idNovel,this.noChapter=this.route.snapshot.params.noChapter,Promise.all([this.api.Novel.get({id:this.idNovel}),this.api.Chapter.get({idNovel:this.idNovel,no:this.noChapter,text:!0})]).then(e=>{this.novel=e[0],this.chapter=e[1],this.renderDataView(),this.cacheAdjecentChapters(this.noChapter-0),this.loadedChapterResolve()})}cacheAdjecentChapters(e){const i=e-1;i>0&&this.api.Chapter.get({idNovel:this.idNovel,no:i,text:!0}).then(r=>{this.chapterPrevious=r});const n=e-0+1;n<=this.novel.numberChapters&&this.api.Chapter.get({idNovel:this.idNovel,no:n,text:!0}).then(r=>{this.chapterNext=r})}renderDataView(){this.renderedTitle=this.chapter.title,this.renderedText=this.chapter.textRevision?this.chapter.textRevision:this.chapter.textOriginal}translateText(e){this.loadedChapter.then(i=>{if(this.renderDataView(),e.length>0){const n=[];e.forEach(c=>{c.entries&&c.entries.forEach(l=>{if(l.entryOriginal){const g=l.entryOriginal.length;n[g]||(n[g]=[]),n[g].push({entryOriginal:l.entryOriginal,entryTranslation:l.entryTranslation,idEntry:l.id,idCategory:c.id,category:c.name})}})});for(let c=n.length;c>0;--c)n[c]&&n[c].forEach(l=>{const g=new RegExp(l.entryOriginal,"g");this.renderedTitle=this.renderedTitle.replace(g,"[["+l.entryTranslation+"]]"),this.renderedText=this.renderedText.replace(g,"[["+l.entryTranslation+"]]")});let r=new RegExp("\\]\\]\\[\\[","g");this.renderedTitle=this.renderedTitle.replace(r," "),this.renderedText=this.renderedText.replace(r," "),r=new RegExp("\\]\\]","g"),this.renderedTitle=this.renderedTitle.replace(r,""),this.renderedText=this.renderedText.replace(r,""),r=new RegExp("\\[\\[","g"),this.renderedTitle=this.renderedTitle.replace(r,""),this.renderedText=this.renderedText.replace(r,"")}})}toogleSidebar(){this.showSidebar=!this.showSidebar}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.F0),t.Y36(_.gz),t.Y36(Y.H7),t.Y36(C.s),t.Y36(p.EM))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-chapter-detail"]],viewQuery:function(e,i){if(1&e&&(t.Gf(v,5),t.Gf(s.xj,5)),2&e){let n;t.iGM(n=t.CRH())&&(i.Sidebar=n.first),t.iGM(n=t.CRH())&&(i.keyboard=n.first)}},decls:12,vars:7,consts:[[1,"flexContent"],[1,"content"],["controlButtons",""],[4,"ngTemplateOutlet"],[4,"ngIf"],[1,"show-sidebar",3,"click"],[1,"sidebar",3,"hidden"],[3,"Sidebar2Chapter"],[3,"shortcuts"],[3,"key","title"],[1,"columns","controlButtons"],[1,"column"],["class","button is-large is-primary",3,"click",4,"ngIf"],[1,"button","is-large","is-primary",3,"routerLink"],[1,"button","is-large","is-primary",3,"click"],[1,"title"],[1,"novel-content",3,"innerHTML"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,I,8,5,"ng-template",null,2,t.W1O),t.YNc(4,V,1,0,"ng-container",3),t.YNc(5,G,5,2,"ng-container",4),t.YNc(6,z,1,0,"ng-container",3),t.qZA(),t.TgZ(7,"div",5),t.NdJ("click",function(){return i.toogleSidebar()}),t.qZA(),t.TgZ(8,"div",6)(9,"app-chapter-sidebar",7),t.NdJ("Sidebar2Chapter",function(r){return i.translateText(r)}),t.qZA()()(),t._UZ(10,"ng-keyboard-shortcuts",8)(11,"ng-keyboard-shortcuts-help",9)),2&e){const n=t.MAs(3);t.xp6(4),t.Q6J("ngTemplateOutlet",n),t.xp6(1),t.Q6J("ngIf",i.chapter),t.xp6(1),t.Q6J("ngTemplateOutlet",n),t.xp6(2),t.Q6J("hidden",!i.showSidebar),t.xp6(2),t.Q6J("shortcuts",i.shortcuts),t.xp6(1),t.Q6J("key","f1")("title","Help")}},styles:[".controlButtons[_ngcontent-%COMP%]{margin-top:1px}.controlButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:100%;text-align:center}.title[_ngcontent-%COMP%], .novel-content[_ngcontent-%COMP%]{color:#fff}.flexContent[_ngcontent-%COMP%]{display:flexbox;flex-direction:row;width:100%;height:100%}.flexContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:calc(100% - 500px);height:100%}.flexContent[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{z-index:20;width:500px;position:fixed;height:100%;right:0px;top:0px;bottom:0px;overflow-y:auto;background:#5e009f}"]}),o})();const W=[{path:"",component:E,data:{title:"List Chapters"}},{path:"dictionary",loadChildren:()=>d.e(125).then(d.bind(d,8125)).then(o=>o.DictionaryModule),data:{title:"View dictionary",breadcrumb:"Dictionaries"}},{path:":noChapter",component:O,data:{title:"View chapter",breadcrumb:"View Chapter"}},{path:"**",redirectTo:""}];let K=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[_.Bz.forChild(W)],_.Bz]}),o})(),X=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[p.ez,K,_.Bz,h.u5,s.Ux.forRoot()]]}),o})();t.B6R(O,[p.O5,_.yS,p.tP,v,s.xj,s.iD],[])}}]);