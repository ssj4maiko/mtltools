"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[259],{6259:(dt,C,p)=>{p.r(C),p.d(C,{DictionaryModule:()=>ht});var g=p(6895),f=p(4793),t=p(4650),m=p(6845);function v(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",5),t.TgZ(1,"div",6),t.TgZ(2,"a",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().LINK(null,"add")}),t._uU(3,"Add Dictionary"),t.qZA(),t.qZA(),t.qZA()}}function T(s,c){1&s&&t.GkF(0)}const A=function(){return[]};function S(s,c){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr"),t.TgZ(2,"td",8),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.oxw().LINK(o.id)}),t._uU(3),t.qZA(),t.TgZ(4,"td",8),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.oxw().LINK(o.id)}),t._uU(5),t.qZA(),t.TgZ(6,"td",8),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.oxw().LINK(o.id)}),t._uU(7),t.qZA(),t.TgZ(8,"td"),t.TgZ(9,"a",9),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.oxw().LINK(o.id,"edit")}),t._UZ(10,"i",10),t.qZA(),t._uU(11," / "),t.TgZ(12,"a",11),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.oxw().delete(o.id)}),t._UZ(13,"i",12),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&s){const e=c.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.language),t.xp6(2),t.Oqu(e.countCategories()),t.xp6(5),t.Q6J("routerLink",t.DdM(4,A))}}let b=(()=>{class s{constructor(e,i,n){this.router=e,this.route=i,this.api=n,this.dictionaries=[],this.idNovel=null}ngOnInit(){this.loadList()}loadList(){this.idNovel=this.route.snapshot.params.idNovel,this.api.Dictionary.getAll({idNovel:this.idNovel}).then(e=>{this.dictionaries=Object.values(e)},e=>{console.log(e)})}LINK(e,i){const n=[];this.idNovel&&(n.push("novel"),n.push(this.idNovel)),n.push("dictionary"),i&&n.push(i),e&&n.push(e),console.log(n),this.router.navigate(n)}delete(e){return confirm("Are you sure?")&&this.api.Dictionary.delete({id:e}).then(i=>{this.loadList()},i=>{console.log(i)}),!0}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.F0),t.Y36(f.gz),t.Y36(m.s))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-dictionary-list"]],decls:17,vars:2,consts:[["actionButtons",""],[4,"ngTemplateOutlet"],[1,"table","is-striped","is-hoverable","is-fullwidth"],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"columns","actionButtons"],[1,"column"],[1,"button","is-info",3,"click"],[3,"click"],[1,"icon","has-text-success",3,"click"],[1,"fas","fa-info-circle"],[1,"icon","has-text-danger",3,"routerLink","click"],[1,"fas","fa-ban"]],template:function(e,i){if(1&e&&(t.YNc(0,v,4,0,"ng-template",null,0,t.W1O),t.YNc(2,T,1,0,"ng-container",1),t.TgZ(3,"div"),t.TgZ(4,"table",2),t.TgZ(5,"thead"),t.TgZ(6,"tr"),t.TgZ(7,"th"),t._uU(8,"Name"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Language"),t.qZA(),t.TgZ(11,"th",3),t._uU(12,"# of Categories"),t.qZA(),t.TgZ(13,"th",3),t._uU(14,"Actions"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(15,"tbody"),t.YNc(16,S,14,5,"ng-container",4),t.qZA(),t.qZA(),t.qZA()),2&e){const n=t.MAs(1);t.xp6(2),t.Q6J("ngTemplateOutlet",n),t.xp6(14),t.Q6J("ngForOf",i.dictionaries)}},directives:[g.tP,g.sg,f.yS],styles:[".actionButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;width:100%}"]}),s})();var a=p(4006),$=p(7783),y=p(2828);let Z=(()=>{class s{constructor(e){this.formBuilder=e,this.selectNovels=[],this.selectLanguages=[],this.indexes=[],this.formGroup=e.group({id:[null],name:[null],language:[null],novel:[null]})}loadMeta(e,i){this.selectLanguages=[];for(const n of Object.keys(e.languages))this.selectLanguages.push(new y.Wx(n,e.languages[n]));this.selectNovels=[];for(const n of Object.keys(i))this.selectNovels.push(new y.Wx(i[n].id+"",i[n].nameCustom,!1))}addForm(e,i,n,o){this.indexes.push(e),this.form.push(new y.Wi(e,i,n,o))}getForm(e){this.form=[],e&&this.addForm("id","","hidden"),this.addForm("name","Name","text"),this.addForm("language","Language","select",this.selectLanguages),this.addForm("novel","Novels","multiselect",this.selectNovels)}setValues(e,i){const n=i.map(r=>r.id+""),o=new a.Oe(this.selectNovels.map(r=>(n.includes(r.value)&&r.setChecked(!0),r.control)));e&&this.formGroup.setValue({id:e.id,name:e.name,language:e.language,novel:o})}getValues(e){const i={dictionary:null,novels:null};i.dictionary=new $.Xy(this.formGroup.value),console.log(i.dictionary),delete i.dictionary.novel;const n=this.indexes.indexOf("novel");if(i.novels=this.form[n].getValues().map(o=>parseInt(o,10)),e&&e.length===i.novels.length){const o=e.map(r=>r.id);JSON.stringify(o)===JSON.stringify(i.novels)&&delete i.novels}return i}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(a.qu))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function N(s,c){if(1&s&&(t.ynx(0,null,12),t._UZ(2,"input",13),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(2),t.s9C("formControlName",e.name)}}function O(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label",15),t._UZ(3,"input",16),t._uU(4),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.s9C("formControlName",e.name),t.xp6(1),t.hij(" ",e.label," ")}}function q(s,c){if(1&s&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.s9C("value",e.value),t.xp6(1),t.Oqu(e.label)}}function D(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label"),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t.TgZ(5,"select",17),t.YNc(6,q,2,2,"option",18),t.qZA(),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.label),t.xp6(2),t.s9C("formControlName",e.name),t.xp6(1),t.Q6J("ngForOf",e.options)}}function E(s,c){if(1&s&&(t.TgZ(0,"p"),t.TgZ(1,"label"),t._UZ(2,"input",21),t._uU(3),t.qZA(),t.qZA()),2&s){const e=c.$implicit;t.xp6(2),t.Q6J("formControl",e.control),t.xp6(1),t.hij(" ",e.label," ")}}function F(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label"),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t.YNc(5,E,4,2,"p",20),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.AsE("",e.label," - ",e.name,""),t.xp6(2),t.Q6J("ngForOf",e.options)}}function M(s,c){if(1&s&&(t.ynx(0,null,22),t.TgZ(2,"label",23),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t._UZ(5,"input",24),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(2),t.s9C("for",e.name),t.xp6(1),t.Oqu(e.label),t.xp6(2),t.s9C("type",e.type),t.s9C("id",e.name),t.s9C("formControlName",e.name)}}function U(s,c){if(1&s&&(t.TgZ(0,"div",8),t.ynx(1,9),t.YNc(2,N,3,1,"ng-container",10),t.YNc(3,O,5,2,"ng-container",10),t.YNc(4,D,7,3,"ng-container",10),t.YNc(5,F,6,3,"ng-container",10),t.YNc(6,M,6,5,"ng-container",11),t.BQk(),t.qZA()),2&s){const e=c.$implicit;t.xp6(1),t.Q6J("ngSwitch",e.type),t.xp6(1),t.Q6J("ngSwitchCase","hidden"),t.xp6(1),t.Q6J("ngSwitchCase","checkbox"),t.xp6(1),t.Q6J("ngSwitchCase","select"),t.xp6(1),t.Q6J("ngSwitchCase","multiselect")}}let w=(()=>{class s extends Z{constructor(e,i,n,o){super(o),this.router=e,this.route=i,this.api=n,this.formBuilder=o}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.idDictionary=this.route.snapshot.params.idDictionary,this.formTitle="Edit Dictionary",Promise.all([this.api.Meta.get("languages"),this.api.Dictionary.get({id:this.idDictionary}),this.api.Novel.getAll()]).then(e=>{this.dictionary=e[1],this.novels=e[2],this.loadMeta(e[0],e[2]),this.idNovel&&this.api.Novel.get({id:this.idNovel}).then(i=>{this.setValues(null,[i])}),this.getForm(!0)})}submitForm(e){const i=this.getValues(this.novels);this.api.Dictionary.add({values:i}).then(n=>{this.goBack()},n=>{console.log(n)})}LINK(e,i){const n=[];this.idNovel&&(n.push("novel"),n.push(this.idNovel)),n.push("dictionary"),i&&n.push(i),e&&n.push(e),this.router.navigate(n)}goBack(){this.LINK()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.F0),t.Y36(f.gz),t.Y36(m.s),t.Y36(a.qu))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-dictionary-add"]],features:[t.qOj],decls:10,vars:3,consts:[[1,"form-content"],[1,"title"],[3,"formGroup","ngSubmit"],["class","field",4,"ngFor","ngForOf"],[1,"field","is-grouped"],[1,"control"],["type","submit","value","Submit",1,"button","is-link"],["value","Cancel",1,"button","is-danger",3,"click"],[1,"field"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["tempHidden",""],["type","hidden",3,"formControlName"],["tempCheck",""],[1,"checkbox"],["type","checkbox",3,"formControlName"],[3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngFor","ngForOf"],["type","checkbox",3,"formControl"],["tempText",""],[1,"label",3,"for"],[1,"input",3,"type","id","formControlName"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h1",1),t._uU(2),t.qZA(),t.TgZ(3,"form",2),t.NdJ("ngSubmit",function(){return i.submitForm(i.formGroup.value)}),t.YNc(4,U,7,5,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t._UZ(7,"input",6),t.qZA(),t.TgZ(8,"div",5),t.TgZ(9,"input",7),t.NdJ("click",function(){return i.goBack()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Oqu(i.formTitle),t.xp6(1),t.Q6J("formGroup",i.formGroup),t.xp6(1),t.Q6J("ngForOf",i.form))},directives:[a._Y,a.JL,a.sg,g.sg,g.RF,g.n9,a.Fj,a.JJ,a.u,a.Wl,a.EJ,a.YN,a.Kr,a.oH,g.ED],styles:[".form-content[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:10px}"]}),s})();function H(s,c){if(1&s&&(t.ynx(0,null,12),t._UZ(2,"input",13),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(2),t.s9C("formControlName",e.name)}}function J(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label",15),t._UZ(3,"input",16),t._uU(4),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.s9C("formControlName",e.name),t.xp6(1),t.hij(" ",e.label," ")}}function k(s,c){if(1&s&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.s9C("value",e.value),t.xp6(1),t.Oqu(e.label)}}function Q(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label"),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t.TgZ(5,"select",17),t.YNc(6,k,2,2,"option",18),t.qZA(),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.label),t.xp6(2),t.s9C("formControlName",e.name),t.xp6(1),t.Q6J("ngForOf",e.options)}}function Y(s,c){if(1&s&&(t.TgZ(0,"p"),t.TgZ(1,"label"),t._UZ(2,"input",21),t._uU(3),t.qZA(),t.qZA()),2&s){const e=c.$implicit;t.xp6(2),t.Q6J("formControl",e.control),t.xp6(1),t.hij(" ",e.label," ")}}function K(s,c){if(1&s&&(t.ynx(0,null,14),t.TgZ(2,"label"),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t.YNc(5,Y,4,2,"p",20),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(3),t.AsE("",e.label," - ",e.name,""),t.xp6(2),t.Q6J("ngForOf",e.options)}}function L(s,c){if(1&s&&(t.ynx(0,null,22),t.TgZ(2,"label",23),t._uU(3),t.qZA(),t.TgZ(4,"div",5),t._UZ(5,"input",24),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit;t.xp6(2),t.s9C("for",e.name),t.xp6(1),t.Oqu(e.label),t.xp6(2),t.s9C("type",e.type),t.s9C("id",e.name),t.s9C("formControlName",e.name)}}function B(s,c){if(1&s&&(t.TgZ(0,"div",8),t.ynx(1,9),t.YNc(2,H,3,1,"ng-container",10),t.YNc(3,J,5,2,"ng-container",10),t.YNc(4,Q,7,3,"ng-container",10),t.YNc(5,K,6,3,"ng-container",10),t.YNc(6,L,6,5,"ng-container",11),t.BQk(),t.qZA()),2&s){const e=c.$implicit;t.xp6(1),t.Q6J("ngSwitch",e.type),t.xp6(1),t.Q6J("ngSwitchCase","hidden"),t.xp6(1),t.Q6J("ngSwitchCase","checkbox"),t.xp6(1),t.Q6J("ngSwitchCase","select"),t.xp6(1),t.Q6J("ngSwitchCase","multiselect")}}let j=(()=>{class s extends Z{constructor(e,i,n,o){super(o),this.router=e,this.route=i,this.api=n,this.formBuilder=o}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.idDictionary=this.route.snapshot.params.idDictionary,this.formTitle="Edit Dictionary",Promise.all([this.api.Meta.get("languages"),this.api.Dictionary.get({id:this.idDictionary}),this.api.Novel.getAll()]).then(e=>{this.api.Novel.getAll({idDictionary:this.idDictionary}).then(i=>{console.log("SELECTED NOVELS",i),this.dictionary=e[1],this.novels=e[2],this.loadMeta(e[0],e[2]),this.setValues(e[1],i),this.getForm(!1)})})}submitForm(e){const i=this.getValues(this.novels);console.log(i),this.api.Dictionary.update({id:this.idDictionary,values:i}).then(n=>{this.goBack()},n=>{console.log(n)})}goBack(){this.router.navigate(["/dictionary"])}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.F0),t.Y36(f.gz),t.Y36(m.s),t.Y36(a.qu))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-dictionary-edit"]],features:[t.qOj],decls:10,vars:3,consts:[[1,"form-content"],[1,"title"],[3,"formGroup","ngSubmit"],["class","field",4,"ngFor","ngForOf"],[1,"field","is-grouped"],[1,"control"],["type","submit","value","Submit",1,"button","is-link"],["value","Cancel",1,"button","is-danger",3,"click"],[1,"field"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["tempHidden",""],["type","hidden",3,"formControlName"],["tempCheck",""],[1,"checkbox"],["type","checkbox",3,"formControlName"],[3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngFor","ngForOf"],["type","checkbox",3,"formControl"],["tempText",""],[1,"label",3,"for"],[1,"input",3,"type","id","formControlName"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h1",1),t._uU(2),t.qZA(),t.TgZ(3,"form",2),t.NdJ("ngSubmit",function(){return i.submitForm(i.formGroup.value)}),t.YNc(4,B,7,5,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t._UZ(7,"input",6),t.qZA(),t.TgZ(8,"div",5),t.TgZ(9,"input",7),t.NdJ("click",function(){return i.goBack()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Oqu(i.formTitle),t.xp6(1),t.Q6J("formGroup",i.formGroup),t.xp6(1),t.Q6J("ngForOf",i.form))},directives:[a._Y,a.JL,a.sg,g.sg,g.RF,g.n9,a.Fj,a.JJ,a.u,a.Wl,a.EJ,a.YN,a.Kr,a.oH,g.ED],styles:[".form-content[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:10px}"]}),s})();var I=p(3178),V=p(1086),x=p(529),h=p(2994),d=p(7221),P=p(2340),G=p(3399);const u={headers:new x.WM({"Content-Type":"application/json"})},l=P.N.backendServer+"/api/";let R=(()=>{class s{constructor(e,i){this.http=e,this.cacheService=i,this._novels={},this._chapters={},this._dictionaries={},this._categories={},this._entries={}}handleError(e="operation",i){return n=>(console.error(n),(0,V.of)(i))}Novels(){return this._novels}Novel(e){return this._novels[e]?this._novels[e]:null}getNovels(){const e=`${l}novel`;return this.cacheService.get(e,this.http.get(e).pipe((0,h.b)(i=>{console.log("Fetched Novels");for(const n in i)this._novels[i[n].id]=i[n]}),(0,d.K)(this.handleError("getNovels",[]))))}addNovel(e){return this.http.post(`${l}novel/`,e,u).pipe((0,h.b)(n=>{console.log(`Registered Novel id=${n.id}`),this._novels[n.id]=n}),(0,d.K)(this.handleError("addNovel")))}getNovel(e){const i=`${l}novel/${e}`;return this.cacheService.get(i,this.http.get(i).pipe((0,h.b)(n=>{console.log(`Fetched Novel id=${e}`),this._novels[n.id]=n}),(0,d.K)(this.handleError(`getNovel id=${e}`))))}updateNovel(e,i){return this.http.put(`${l}novel/${e}`,i,u).pipe((0,h.b)(o=>{console.log(`Updated Novel id=${o.id}`),this._novels[o.id]=o}),(0,d.K)(this.handleError("updateNovel")))}deleteNovel(e){return this.http.delete(`${l}novel/${e}`,u).pipe((0,h.b)(n=>{console.log(`Deleted Novel id=${e}`),delete this._novels[e]}),(0,d.K)(this.handleError("deleteNovel")))}updateIndexNovel(e){return this.http.get(`${l}chapter/autoUpdate/${e}`).pipe((0,h.b)(n=>{console.log(`Updated All Chapters id=${n.id}`),this._novels[n.id]=n,this.cacheService.delete(`${l}chapter/${n.id}`),this._chapters[n.id]&&delete this._chapters[n.id]}),(0,d.K)(this.handleError("updateIndexNovel")))}Chapters(e){return this._chapters[e]?this._chapters[e]:[]}Chapter(e,i){return this._chapters[e]&&this._chapters[e][i]?this._chapters[e][i]:null}getChapters(e,i){const n=`${l}chapter/${e}`;return i&&this.cacheService.delete(n),this.cacheService.get(n,this.http.get(n).pipe((0,h.b)(o=>{if(console.log("Fetched chapters"),o&&o[0]){this._chapters[e]||(this._chapters[e]={});for(const r in o)this._chapters[e][o[r].no]&&this._chapters[e][o[r].no].textOriginal&&this._chapters[e][o[r].no].dateOriginalRevision==o[r].dateOriginalRevision||(this._chapters[e][o[r].no]=o[r])}}),(0,d.K)(this.handleError("getchapters",[]))))}getAutoChapter(e){return this.http.get(`${l}chapter/auto/${e}`).pipe((0,h.b)(n=>{this._novels[e]=n.novel,this._chapters[e]||(this._chapters[e]={}),this._chapters[e][n.chapter.no]=n.chapter}),(0,d.K)(this.handleError("addChapter")))}autoUpdateChapters(e){return this.http.get(`${l}chapter/autoUpdate/${e}`).pipe((0,h.b)(n=>{this._novels[e]=n}),(0,d.K)(this.handleError("addChapter")))}getChapter(e,i){return this.http.get(`${l}chapter/${e}/${i}`).pipe((0,h.b)(o=>{console.log(`Fetched Chapter id=${o.no}`),this._chapters[e]||(this._chapters[e]={}),this._chapters[e][o.no]=o}),(0,d.K)(this.handleError(`getChapter id=${i}`)))}Dictionaries(){return this._dictionaries?this._dictionaries:[]}Dictionary(e){return this._dictionaries&&this._dictionaries[e]?this._dictionaries[e]:null}getDictionaries(){const e=`${l}dictionary/`;return this.cacheService.get(e,this.http.get(e).pipe((0,h.b)(i=>{if(console.log("Fetched Dictionaries"),i&&i[0]){this._dictionaries={};for(const n in i)this._dictionaries[i[n].id]=i[n]}}),(0,d.K)(this.handleError("getDictionaries",[]))))}getDictionary(e){const i=`${l}dictionary/${e}`;return this.cacheService.get(i,this.http.get(i).pipe((0,h.b)(n=>{console.log(`Fetched Dictionary id=${e}`),console.log(n),this._dictionaries||(this._dictionaries={}),this._dictionaries[n.id]=n}),(0,d.K)(this.handleError(`getDictionary id=${e}`))))}addDictionary(e){return this.http.post(`${l}dictionary/`,e,u).pipe((0,h.b)(n=>{console.log(`Registered Dictionary id=${n.id}`),this._dictionaries||(this._dictionaries={}),this._dictionaries[n.id]=n}),(0,d.K)(this.handleError("addDictionary")))}updateDictionary(e,i){return this.http.put(`${l}dictionary/${e}`,i,u).pipe((0,h.b)(o=>{console.log(`Updated Dictionary id=${o.id}`),this._dictionaries||(this._dictionaries={}),console.log(this._dictionaries[o.id]);for(const r in o)console.log(r),this._dictionaries[o.id][r]=o[r]}),(0,d.K)(this.handleError("updateDictionary")))}deleteDictionary(e){return this.http.delete(`${l}dictionary/${e}`,u).pipe((0,h.b)(n=>{console.log(`Deleted Dictionary id=${e}`),delete this._dictionaries[e]}),(0,d.K)(this.handleError("deleteNovel")))}dictionaryCreateCache(e){return this.http.put(`${l}cache/dictionary/${e}`,u).pipe((0,h.b)(n=>{console.log(`Cached Dictionary id=${e}`),console.log(n)}),(0,d.K)(this.handleError("deleteNovel")))}setDictionaries(e){this._dictionaries||(this._dictionaries={});const i=this;e.forEach(n=>{i._dictionaries[n.id]=n})}dictionaryCache(e){const i=`${l}cache/dictionary/${e}?${this._dictionaries[e].dateRevision}`;return this.cacheService.get(i,this.http.get(i).pipe((0,h.b)(n=>{console.log("Fetched Cache"),1==n.length&&((n=n[0]).dictionary_entry.length>0&&n.dictionary_entry.forEach(o=>{this._entries[o.idCategory]||(this._entries[o.idCategory]=[]),this._entries[o.idCategory][o.id]=o}),n.dictionary_category.length>0&&(this._categories[e]||(this._categories[e]=[]),n.dictionary_category.forEach(o=>{this._categories[o.idDictionary][o.id]||(this._categories[o.idDictionary][o.id]={});for(const r in o)this._categories[o.idDictionary][o.id][r]=o[r];this._categories[o.idDictionary][o.id].count_entries=[],this._categories[o.idDictionary][o.id].count_entries[0]={},this._categories[o.idDictionary][o.id].count_entries[0].count=this._entries[o.id]?Object.keys(this._entries[o.id]).length:0})))}),(0,d.K)(this.handleError("getCategory",[]))))}saveFullDictionary(e,i){return this.http.put(`${l}dictionary/fullSave/${e}`,i,u).pipe((0,h.b)(o=>{o.changes&&(this._dictionaries[e].dateRevision=o.dateRevision,this.cacheService.delete(`${l}dictionary/cache/${e}?${this._dictionaries[e].dateRevision}`))}),(0,d.K)(this.handleError("getCategory")))}updateCounterCategory(e,i){switch(e){case"+":++this._dictionaries[i].count_categories[0].count;break;case"-":--this._dictionaries[i].count_categories[0].count;break;default:this._dictionaries[i].count_categories[0].count=e}}Categories(e){return this._categories[e]?this._categories[e]:[]}Category(e,i){return this._categories[e]&&this._categories[e][i]?this._categories[e][i]:null}getCategories(e,i){const n=`${l}category/${e}`;return i&&this.cacheService.delete(n),this.cacheService.get(n,this.http.get(n).pipe((0,h.b)(o=>{if(console.log("Fetched Category"),o&&o[0]){this._categories[e]={};let r=0;for(const _ in o)++r,this._categories[e][o[_].id]=o[_];this.updateCounterCategory(r,e)}}),(0,d.K)(this.handleError("getCategory",[]))))}getCategory(e,i){const n=`${l}category/${e}/${i}`;return this.cacheService.get(n,this.http.get(n).pipe((0,h.b)(o=>{console.log(`Fetched Category id=${i}`),console.log(o),this._categories[o.idDictionary]||(this._categories[o.idDictionary]={}),this._categories[o.idDictionary][o.id]=o}),(0,d.K)(this.handleError(`getCategory id=${i}`))))}addCategory(e,i){return this.http.post(`${l}category/${e}`,i,u).pipe((0,h.b)(o=>{console.log(`Registered Category id=${o.id}`),this._categories[o.idDictionary]||(this._categories[o.idDictionary]={}),this._categories[o.idDictionary][o.id]=o,this.updateCounterCategory("+",e)}),(0,d.K)(this.handleError("addCategory")))}updateCategory(e,i,n){return this.http.put(`${l}category/${e}/${i}`,n,u).pipe((0,h.b)(r=>{console.log(`Updated Category id=${r.id}`),this._categories[r.idDictionary]||(this._categories[r.idDictionary]={}),this._categories[r.idDictionary][r.id]=r}),(0,d.K)(this.handleError("updateCategory")))}deleteCategory(e,i){return this.http.delete(`${l}category/${e}/${i}`,u).pipe((0,h.b)(o=>{console.log(`Deleted Category id=${i}`),delete this._categories[e][i],this.updateCounterCategory("-",e)}),(0,d.K)(this.handleError("deleteNovel")))}updateCounterEntry(e,i,n){if(this._categories[i][n].count_entries)switch(e){case"+":++this._categories[i][n].count_entries[0].count;break;case"-":--this._categories[i][n].count_entries[0].count;break;default:this._categories[i][n].count_entries&&(this._categories[i][n].count_entries=[]),this._categories[i][n].count_entries[0].count=e}}Entries(e){return this._entries[e]?this._entries[e]:[]}Entry(e,i){return this._entries[e]&&this._entries[e][i]?this._entries[e][i]:null}getEntries(e,i,n){return this.http.get(`${l}entry/${i}`).pipe((0,h.b)(r=>{if(console.log("Fetched Entries"),r&&r[0]){this._entries[i]={};for(const _ in r)this._entries[i][r[_].id]=r[_]}n&&this.updateCounterEntry(r.length,e,i)}),(0,d.K)(this.handleError("getCategory",[])))}addEntries(e,i,n){return this.http.post(`${l}entry/updatecategory/${i}`,n,u).pipe((0,h.b)(r=>{}),(0,d.K)(this.handleError("addCategory")))}updateEntry(e,i,n){return this.http.put(`${l}entry/${e}/${i}`,n,u).pipe((0,h.b)(r=>{console.log(`Updated entry id=${r.id}`),this._entries[r.idCategory]||(this._entries[r.idCategory]={}),this._entries[r.idCategory][r.id]=r}),(0,d.K)(this.handleError("updateCategory")))}deleteEntry(e,i){return this.http.delete(`${l}entry/${e}/${i}`,u).pipe((0,h.b)(o=>{console.log(`Deleted Category id=${i}`),delete this._entries[e][i]}),(0,d.K)(this.handleError("deleteNovel")))}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(x.eN),t.LFG(G.Q))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function z(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",9),t.TgZ(1,"div",10),t.TgZ(2,"a",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().saveList()}),t._uU(3,"Save List"),t.qZA(),t.qZA(),t.qZA()}}function W(s,c){1&s&&t.GkF(0)}function X(s,c){if(1&s&&(t.TgZ(0,"option",12),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.language)}}function tt(s,c){if(1&s&&(t.ynx(0),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.BQk()),2&s){const e=t.oxw().$implicit,i=t.oxw();t.xp6(2),t.hij(" ",i.categoriesSelectedHash[i.entriesSelected[i.entry2SelectHash[e].selected].idCategory].name," "),t.xp6(2),t.hij(" ",i.entriesSelected[i.entry2SelectHash[e].selected].entryTranslation," "),t.xp6(2),t.hij(" ",i.entriesSelected[i.entry2SelectHash[e].selected].entryOriginal," "),t.xp6(2),t.hij(" ",i.entriesSelected[i.entry2SelectHash[e].selected].description," ")}}function et(s,c){1&s&&(t.TgZ(0,"td"),t._uU(1," - "),t.qZA(),t.TgZ(2,"td"),t._uU(3," - "),t.qZA(),t.TgZ(4,"td"),t._uU(5," - "),t.qZA(),t.TgZ(6,"td"),t._uU(7," - "),t.qZA())}function it(s,c){if(1&s&&(t.TgZ(0,"option",12),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function nt(s,c){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"td"),t.TgZ(2,"select",17),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return r.entries[r.entry2SelectHash[o].entry].idCategory=n})("ngModelChange",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return o.changeEntry(o.entries[o.entry2SelectHash[n].entry])}),t.YNc(3,it,2,2,"option",6),t.qZA(),t.qZA(),t.TgZ(4,"td"),t.TgZ(5,"input",18),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return r.entries[r.entry2SelectHash[o].entry].entryTranslation=n})("ngModelChange",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return o.changeEntry(o.entries[o.entry2SelectHash[n].entry])}),t.qZA(),t.qZA(),t.TgZ(6,"td"),t.TgZ(7,"input",18),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return r.entries[r.entry2SelectHash[o].entry].entryOriginal=n})("ngModelChange",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return o.changeEntry(o.entries[o.entry2SelectHash[n].entry])}),t.qZA(),t.qZA(),t.TgZ(8,"td"),t.TgZ(9,"input",18),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return r.entries[r.entry2SelectHash[o].entry].description=n})("ngModelChange",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return o.changeEntry(o.entries[o.entry2SelectHash[n].entry])}),t.qZA(),t.qZA(),t.BQk()}if(2&s){const e=t.oxw().$implicit,i=t.oxw();t.xp6(2),t.Q6J("ngModel",i.entries[i.entry2SelectHash[e].entry].idCategory),t.xp6(1),t.Q6J("ngForOf",i.categories),t.xp6(2),t.Q6J("ngModel",i.entries[i.entry2SelectHash[e].entry].entryTranslation),t.xp6(2),t.Q6J("ngModel",i.entries[i.entry2SelectHash[e].entry].entryOriginal),t.xp6(2),t.Q6J("ngModel",i.entries[i.entry2SelectHash[e].entry].description)}}function ot(s,c){if(1&s&&(t.TgZ(0,"option",12),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function st(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"td"),t.TgZ(1,"select",19),t.NdJ("change",function(n){t.CHM(e);const o=t.oxw().index;return t.oxw().addEntry(n,o)}),t.TgZ(2,"option",20),t._uU(3,"Select a category to copy"),t.qZA(),t.YNc(4,ot,2,2,"option",6),t.qZA(),t.qZA(),t.TgZ(5,"td"),t._uU(6," - "),t.qZA(),t.TgZ(7,"td"),t._uU(8," - "),t.qZA(),t.TgZ(9,"td"),t._uU(10," - "),t.qZA()}if(2&s){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.categories)}}const rt=function(s,c,e){return{new:s,deleted:c,changed:e}};function ct(s,c){if(1&s&&(t.ynx(0),t.TgZ(1,"tr",13),t.YNc(2,tt,9,4,"ng-container",14),t.YNc(3,et,8,0,"ng-template",null,15,t.W1O),t.TgZ(5,"td"),t._uU(6,"|"),t.qZA(),t.YNc(7,nt,10,5,"ng-container",14),t.YNc(8,st,11,1,"ng-template",null,16,t.W1O),t.qZA(),t.BQk()),2&s){const e=c.$implicit,i=t.MAs(4),n=t.MAs(9),o=t.oxw();t.xp6(1),t.Q6J("ngClass",t.kEZ(5,rt,o.entry2SelectHash[e].entry&&0==o.entries[o.entry2SelectHash[e].entry].id,o.entry2SelectHash[e].entry&&1==o.entries[o.entry2SelectHash[e].entry].delete,o.entry2SelectHash[e].entry&&1==o.entries[o.entry2SelectHash[e].entry].update)),t.xp6(1),t.Q6J("ngIf",o.entry2SelectHash[e]&&o.entry2SelectHash[e].selected)("ngIfElse",i),t.xp6(5),t.Q6J("ngIf",o.entry2SelectHash[e]&&null!=o.entry2SelectHash[e].entry)("ngIfElse",n)}}const at=[{path:"",component:b,data:{title:"List Dictionaries"}},{path:"add",component:w,data:{title:"Add Dictionaries",breadcrumb:"Add Dictionary"}},{path:"edit/:idDictionary",component:j,data:{title:"Edit Dictionary",breadcrumb:"Edit Dictionary"}},{path:"diff/:idDictionary",component:(()=>{class s{constructor(e,i,n){this.api=e,this.route=i,this.router=n,this.dictionaries=[],this.categories=[],this.categoriesHash={},this.entries=[],this.entriesOriginalValues={},this.entry2SelectHash={},this.entry2SelectHashKeys=[],this.categoriesSelected=[],this.categoriesSelectedHash={},this.entriesSelected=[]}ngOnInit(){this.idNovel=this.route.snapshot.params.idNovel,this.idDictionary=this.route.snapshot.params.idDictionary,this.dictionaries=Object.values(this.api.Dictionaries()),0==this.dictionaries.length?this.api.getDictionaries().subscribe(e=>{const i=this.api.Dictionaries();i&&(this.dictionaries=Object.values(i)),this.getCache()},e=>{console.log(e)}):this.getCache()}ngOnDestroy(){delete this.dictionaries,delete this.categories,delete this.categoriesHash,delete this.entries,delete this.idDictionary,delete this.entry2SelectHash,delete this.entry2SelectHashKeys,delete this.categoriesSelected,delete this.categoriesSelectedHash,delete this.entriesSelected,delete this.idDictionarySelected}loadSelectedDictionary(){this.getSelectedCache()}changeEntry(e){e.id>0&&(console.log(e.id),console.log(e.idCategory),e.update=e.entryOriginal!=this.entriesOriginalValues[e.id].entryOriginal||e.entryTranslation!=this.entriesOriginalValues[e.id].entryTranslation||!!e.description&&e.description!=this.entriesOriginalValues[e.id].description||e.idCategory!=this.entriesOriginalValues[e.id].idCategory,console.log(e))}addEntry(e,i){const n=e.target.value,o=this.entry2SelectHash[this.entry2SelectHashKeys[i]],r=this.entriesSelected[o.selected],_=new I.G;_.id=0,_.idCategory=n,_.entryOriginal=r.entryOriginal,_.entryTranslation=r.entryTranslation,_.description=r.description,o.entry=this.entries.length,this.entries.push(_)}saveList(){const e={},i=[];this.categories.forEach(n=>{i.push(n),e[n.id]=[]}),this.entries.forEach(n=>{e[n.idCategory].push(n)}),i.forEach(n=>{n.entries=e[n.id]}),this.api.saveFullDictionary(this.idDictionary,i).subscribe(n=>{n.changes&&(this.dictionaries=Object.values(this.api.Dictionaries()),this.categories=[],this.router.navigate(["/novel/dictionary/"])),console.log(n)},n=>{console.log(n)})}getCache(){0==this.categories.length&&this.api.dictionaryCache(this.idDictionary).subscribe(e=>{this.categories=[],this.entries=[],this.categories=Object.values(this.api.Categories(this.idDictionary)),this.categories.forEach(i=>{this.categoriesHash[i.id]={name:i.name};const n=this.api.Entries(i.id);for(const o in n)this.entry2SelectHash[n[o].entryOriginal]={entry:this.entries.length,selected:null},this.entries.push(n[o]),this.entriesOriginalValues[n[o].id]={entryOriginal:""+n[o].entryOriginal,entryTranslation:""+n[o].entryTranslation,description:""+n[o].description,idCategory:""+n[o].idCategory}}),this.entry2SelectHashKeys=Object.keys(this.entry2SelectHash)},e=>{console.log(e)})}getSelectedCache(){this.api.dictionaryCache(this.idDictionarySelected).subscribe(e=>{this.categoriesSelected=[],this.entriesSelected=[],this.categoriesSelected=Object.values(this.api.Categories(this.idDictionarySelected)),this.categoriesSelected.forEach(i=>{this.categoriesSelectedHash[i.id]={name:i.name};const n=this.api.Entries(i.id);for(const o in n)this.entry2SelectHash[n[o].entryOriginal]?this.entry2SelectHash[n[o].entryOriginal].selected=this.entriesSelected.length:this.entry2SelectHash[n[o].entryOriginal]={entry:null,selected:this.entriesSelected.length},this.entriesSelected.push(n[o])}),this.entry2SelectHashKeys=Object.keys(this.entry2SelectHash)},e=>{console.log(e)})}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(R),t.Y36(f.gz),t.Y36(f.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-diff"]],decls:33,vars:4,consts:[["actionButtons",""],[4,"ngTemplateOutlet"],[1,"table","is-stripede","is-fullwidth","tableContent"],["colspan","4"],[3,"ngModel","ngModelChange","change"],["value","","selected","selected"],[3,"value",4,"ngFor","ngForOf"],[1,"tableContent"],[4,"ngFor","ngForOf"],[1,"columns","actionButtons"],[1,"column"],[1,"button","is-info",3,"click"],[3,"value"],[3,"ngClass"],[4,"ngIf","ngIfElse"],["selectedEmpty",""],["nonAnEntry",""],[3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],[3,"change"],["value",""]],template:function(e,i){if(1&e&&(t.YNc(0,z,4,0,"ng-template",null,0,t.W1O),t.YNc(2,W,1,0,"ng-container",1),t.TgZ(3,"div"),t.TgZ(4,"table",2),t.TgZ(5,"thead"),t.TgZ(6,"tr"),t.TgZ(7,"th",3),t.TgZ(8,"select",4),t.NdJ("ngModelChange",function(o){return i.idDictionarySelected=o})("change",function(){return i.loadSelectedDictionary()}),t.TgZ(9,"option",5),t._uU(10,"Select a Dictionary"),t.qZA(),t.YNc(11,X,2,2,"option",6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"tr"),t.TgZ(13,"th"),t._uU(14,"Original"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Translated"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Description"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Category"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"|"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Category"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Original"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Translated"),t.qZA(),t.TgZ(29,"th"),t._uU(30,"Description"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(31,"tbody",7),t.YNc(32,ct,10,9,"ng-container",8),t.qZA(),t.qZA(),t.qZA()),2&e){const n=t.MAs(1);t.xp6(2),t.Q6J("ngTemplateOutlet",n),t.xp6(6),t.Q6J("ngModel",i.idDictionarySelected),t.xp6(3),t.Q6J("ngForOf",i.dictionaries),t.xp6(21),t.Q6J("ngForOf",i.entry2SelectHashKeys)}},directives:[g.tP,a.EJ,a.JJ,a.On,a.YN,a.Kr,g.sg,g.mk,g.O5,a.Fj],styles:[".actionButtons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-align:center;width:100%}.tableContent[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#eee}.tableContent[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr.changed[_ngcontent-%COMP%]{background-color:#afa}.tableContent[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr.new[_ngcontent-%COMP%]{background-color:#aaf}"]}),s})(),data:{title:"Diff Dictionary",breadcrumb:"Diff"}},{path:":idDictionary",loadChildren:()=>p.e(912).then(p.bind(p,912)).then(s=>s.CategoryModule),data:{title:"View categories",breadcrumb:"View Categories"}},{path:"**",redirectTo:""}];let lt=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[g.ez,f.Bz.forChild(at)],f.Bz]}),s})(),ht=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[g.ez,lt,a.u5,a.UX]]}),s})()}}]);